var qqdropbox=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o),function(){qqdropbox(e).detach(t,o)}},detach:function(t,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.attachEvent&&e.detachEvent("on"+t,o),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e)):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(null==e.style)throw new qqdropbox.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qqdropbox.extend(e.style,t),this},hasClass:function(t){var o=new RegExp("(^| )"+t+"( |$)");return o.test(e.className)},addClass:function(t){return qqdropbox(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var o=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(o," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){var o,n=[];return e.querySelectorAll?e.querySelectorAll("."+t):(o=e.getElementsByTagName("*"),qqdropbox.each(o,function(e,o){qqdropbox(o).hasClass(t)&&n.push(o)}),n)},children:function(){for(var t=[],o=e.firstChild;o;)1===o.nodeType&&t.push(o),o=o.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qqdropbox(e).setText("")},hasAttribute:function(t){var o;return e.hasAttribute?e.hasAttribute(t)?null==/^false$/i.exec(e.getAttribute(t)):!1:(o=e[t],void 0===o?!1:null==/^false$/i.exec(o))}}};!function(){"use strict";qqdropbox.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qqdropbox.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},qqdropbox.isFunction=function(e){return"function"==typeof e},qqdropbox.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qqdropbox.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},qqdropbox.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},qqdropbox.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},qqdropbox.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qqdropbox.format=function(e){var t=Array.prototype.slice.call(arguments,1),o=e,n=o.indexOf("{}");return qqdropbox.each(t,function(e,t){var r=o.substring(0,n),i=o.substring(n+2);return o=r+t+i,n=o.indexOf("{}",n+t.length),0>n?!1:void 0}),o},qqdropbox.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},qqdropbox.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},qqdropbox.isFileOrInput=function(e){return qqdropbox.isFile(e)||qqdropbox.isInput(e)},qqdropbox.isInput=function(e,t){var o=function(e){var o=e.toLowerCase();return t?"file"!==o:"file"===o};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&o(e.type)?!0:e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&o(e.type)?!0:!1},qqdropbox.isBlob=function(e){return window.Blob&&"[object Blob]"===Object.prototype.toString.call(e)?!0:void 0},qqdropbox.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof qqdropbox.createXhrInstance().upload},qqdropbox.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qqdropbox.log("Neither XHR or ActiveX are supported!","error"),null}},qqdropbox.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qqdropbox.isFileChunkingSupported=function(){return!qqdropbox.androidStock()&&qqdropbox.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qqdropbox.sliceBlob=function(e,t,o){var n=e.slice||e.mozSlice||e.webkitSlice;return n.call(e,t,o)},qqdropbox.arrayBufferToHex=function(e){var t="",o=new Uint8Array(e);return qqdropbox.each(o,function(e,o){var n=o.toString(16);n.length<2&&(n="0"+n),t+=n}),t},qqdropbox.readBlobToHex=function(e,t,o){var n=qqdropbox.sliceBlob(e,t,t+o),r=new FileReader,i=new qqdropbox.Promise;return r.onload=function(){i.success(qqdropbox.arrayBufferToHex(r.result))},r.onerror=i.failure,r.readAsArrayBuffer(n),i},qqdropbox.extend=function(e,t,o){return qqdropbox.each(t,function(t,n){o&&qqdropbox.isObject(n)?(void 0===e[t]&&(e[t]={}),qqdropbox.extend(e[t],n,!0)):e[t]=n}),e},qqdropbox.override=function(e,t){var o={},n=t(o);return qqdropbox.each(n,function(t,n){void 0!==e[t]&&(o[t]=e[t]),e[t]=n}),e},qqdropbox.indexOf=function(e,t,o){if(e.indexOf)return e.indexOf(t,o);o=o||0;var n=e.length;for(0>o&&(o+=n);n>o;o+=1)if(e.hasOwnProperty(o)&&e[o]===t)return o;return-1},qqdropbox.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"==e?t:3&t|8;return o.toString(16)})},qqdropbox.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")},qqdropbox.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qqdropbox.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qqdropbox.ie11=function(){return-1!==navigator.userAgent.indexOf("Trident")&&-1!==navigator.userAgent.indexOf("rv:11")},qqdropbox.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qqdropbox.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qqdropbox.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qqdropbox.firefox=function(){return!qqdropbox.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qqdropbox.windows=function(){return"Win32"===navigator.platform},qqdropbox.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qqdropbox.androidStock=function(){return qqdropbox.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qqdropbox.ios7=function(){return qqdropbox.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qqdropbox.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qqdropbox.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qqdropbox.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var o=e.firstChild;return e.removeChild(o),o}}(),qqdropbox.each=function(e,t){var o,n;if(e)if(window.Storage&&e.constructor===window.Storage)for(o=0;o<e.length&&(n=t(e.key(o),e.getItem(e.key(o))),n!==!1);o++);else if(qqdropbox.isArray(e)||qqdropbox.isItemList(e)||qqdropbox.isNodeList(e))for(o=0;o<e.length&&(n=t(o,e[o]),n!==!1);o++);else if(qqdropbox.isString(e))for(o=0;o<e.length&&(n=t(o,e.charAt(o)),n!==!1);o++);else for(o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&(n=t(o,e[o]),n===!1))break},qqdropbox.bind=function(e,t){if(qqdropbox.isFunction(e)){var o=Array.prototype.slice.call(arguments,2);return function(){var n=qqdropbox.extend([],o);return arguments.length&&(n=n.concat(Array.prototype.slice.call(arguments))),e.apply(t,n)}}throw new Error("first parameter must be a function!")},qqdropbox.obj2url=function(e,t,o){var n=[],r="&",i=function(e,o){var r=t?/\[\]$/.test(t)?t:t+"["+o+"]":o;"undefined"!==r&&"undefined"!==o&&n.push("object"==typeof e?qqdropbox.obj2url(e,r,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))};return!o&&t?(r=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(qqdropbox.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e?qqdropbox.each(e,function(e,t){i(t,e)}):"undefined"!=typeof e&&null!==e&&"object"==typeof e?qqdropbox.each(e,function(e,t){i(t,e)}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?n.join(r):n.join(r).replace(/^&/,"").replace(/%20/g,"+")},qqdropbox.obj2FormData=function(e,t,o){return t||(t=new FormData),qqdropbox.each(e,function(e,n){e=o?o+"["+e+"]":e,qqdropbox.isObject(n)?qqdropbox.obj2FormData(n,t,e):qqdropbox.isFunction(n)?t.append(e,n()):t.append(e,n)}),t},qqdropbox.obj2Inputs=function(e,t){var o;return t||(t=document.createElement("form")),qqdropbox.obj2FormData(e,{append:function(e,n){o=document.createElement("input"),o.setAttribute("name",e),o.setAttribute("value",n),t.appendChild(o)}}),t},qqdropbox.parseJson=function(json){return window.JSON&&qqdropbox.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qqdropbox.getExtension=function(e){var t=e.lastIndexOf(".")+1;return t>0?e.substr(t,e.length-t):void 0},qqdropbox.getFilename=function(e){return qqdropbox.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qqdropbox.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},qqdropbox.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(qqdropbox(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";qqdropbox.Error=function(e){this.message="[Fine Uploader "+qqdropbox.version+"] "+e},qqdropbox.Error.prototype=new Error}(),qqdropbox.version="5.0.1",qqdropbox.supportedFeatures=function(){"use strict";function e(){var e,t=!0;try{e=document.createElement("input"),e.type="file",qqdropbox(e).hide(),e.disabled&&(t=!1)}catch(o){t=!1}return t}function t(){return(qqdropbox.chrome()||qqdropbox.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function o(){return(qqdropbox.chrome()||qqdropbox.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function n(){if(window.XMLHttpRequest){var e=qqdropbox.createXhrInstance();return void 0!==e.withCredentials}return!1}function r(){return void 0!==window.XDomainRequest}function i(){return n()?!0:r()}function a(){return void 0!==document.createElement("input").webkitdirectory}var s,d,u,l,p,c,h,f,q,m,b,g,x,_;return s=e(),u=s&&qqdropbox.isXhrUploadSupported(),d=u&&!qqdropbox.androidStock(),l=u&&t(),p=u&&qqdropbox.isFileChunkingSupported(),c=u&&p&&!!window.localStorage,h=u&&o(),f=s&&(void 0!==window.postMessage||u),m=n(),q=r(),b=i(),g=a(),x=u&&void 0!==window.FileReader,_=function(){return u?!(qqdropbox.androidStock()||qqdropbox.ios()&&navigator.userAgent.indexOf("CriOS")>=0):!1}(),{ajaxUploading:u,blobUploading:d,canDetermineSize:u,chunking:p,deleteFileCors:b,deleteFileCorsXdr:q,deleteFileCorsXhr:m,fileDrop:u,folderDrop:l,folderSelection:g,imagePreviews:x,imageValidation:x,itemSizeValidation:u,pause:p,progressBar:_,resume:c,scaling:x&&d,tiffPreviews:qqdropbox.safari(),uploading:s,uploadCors:f,uploadCustomHeaders:u,uploadNonMultipart:u,uploadViaPaste:h}}(),qqdropbox.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qqdropbox.isFunction(e.then))},qqdropbox.Promise=function(){"use strict";var e,t,o=[],n=[],r=[],i=0;qqdropbox.extend(this,{then:function(r,a){return 0===i?(r&&o.push(r),a&&n.push(a)):-1===i?a&&a.apply(null,t):r&&r.apply(null,e),this},done:function(o){return 0===i?r.push(o):o.apply(null,void 0===t?e:t),this},success:function(){return i=1,e=arguments,o.length&&qqdropbox.each(o,function(t,o){o.apply(null,e)}),r.length&&qqdropbox.each(r,function(t,o){o.apply(null,e)}),this},failure:function(){return i=-1,t=arguments,n.length&&qqdropbox.each(n,function(e,o){o.apply(null,t)}),r.length&&qqdropbox.each(r,function(e,o){o.apply(null,t)}),this}})},qqdropbox.BlobProxy=function(e,t){"use strict";qqdropbox.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qqdropbox.UploadButton=function(e){"use strict";function t(){var e=document.createElement("input");return e.setAttribute(qqdropbox.UploadButton.BUTTON_ID_ATTR_NAME,n),i.multiple&&e.setAttribute("multiple",""),i.folders&&qqdropbox.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),i.acceptFiles&&e.setAttribute("accept",i.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",i.name),qqdropbox(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),i.element.appendChild(e),r.attach(e,"change",function(){i.onChange(e)}),r.attach(e,"mouseover",function(){qqdropbox(i.element).addClass(i.hoverClass)}),r.attach(e,"mouseout",function(){qqdropbox(i.element).removeClass(i.hoverClass)}),r.attach(e,"focus",function(){qqdropbox(i.element).addClass(i.focusClass)}),r.attach(e,"blur",function(){qqdropbox(i.element).removeClass(i.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}var o,n,r=new qqdropbox.DisposeSupport,i={element:null,multiple:!1,acceptFiles:null,folders:!1,name:"qqfile",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qqdropbox.extend(i,e),n=qqdropbox.getUniqueId(),qqdropbox(i.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),o=t(),qqdropbox.extend(this,{getInput:function(){return o},getButtonId:function(){return n},setMultiple:function(e){e!==i.multiple&&(e?o.setAttribute("multiple",""):o.removeAttribute("multiple"))},setAcceptFiles:function(e){e!==i.acceptFiles&&o.setAttribute("accept",e)},reset:function(){o.parentNode&&qqdropbox(o).remove(),qqdropbox(i.element).removeClass(i.focusClass),o=t()}})},qqdropbox.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qqdropbox.UploadData=function(e){"use strict";function t(e){if(qqdropbox.isArray(e)){var t=[];return qqdropbox.each(e,function(e,o){t.push(r[o])}),t}return r[e]}function o(e){if(qqdropbox.isArray(e)){var t=[];return qqdropbox.each(e,function(e,o){t.push(r[i[o]])}),t}return r[i[e]]}function n(e){var t=[],o=[].concat(e);return qqdropbox.each(o,function(e,o){var n=a[o];void 0!==n&&qqdropbox.each(n,function(e,o){t.push(r[o])})}),t}var r=[],i={},a={},s={},d={};qqdropbox.extend(this,{addFile:function(t){var o=t.status||qqdropbox.status.SUBMITTING,n=r.push({name:t.name,originalName:t.name,uuid:t.uuid,size:t.size||-1,status:o})-1;return t.batchId&&(r[n].batchId=t.batchId,void 0===d[t.batchId]&&(d[t.batchId]=[]),d[t.batchId].push(n)),t.proxyGroupId&&(r[n].proxyGroupId=t.proxyGroupId,void 0===s[t.proxyGroupId]&&(s[t.proxyGroupId]=[]),s[t.proxyGroupId].push(n)),r[n].id=n,i[t.uuid]=n,void 0===a[o]&&(a[o]=[]),a[o].push(n),e.onStatusChange(n,null,o),n},retrieve:function(e){return qqdropbox.isObject(e)&&r.length?void 0!==e.id?t(e.id):void 0!==e.uuid?o(e.uuid):e.status?n(e.status):void 0:qqdropbox.extend([],r,!0)},reset:function(){r=[],i={},a={},d={}},setStatus:function(t,o){var n=r[t].status,i=qqdropbox.indexOf(a[n],t);a[n].splice(i,1),r[t].status=o,void 0===a[o]&&(a[o]=[]),a[o].push(t),e.onStatusChange(t,n,o)},uuidChanged:function(e,t){var o=r[e].uuid;r[e].uuid=t,i[t]=e,delete i[o]},updateName:function(e,t){r[e].name=t},updateSize:function(e,t){r[e].size=t},setParentId:function(e,t){r[e].parentId=t},getIdsInProxyGroup:function(e){var t=r[e].proxyGroupId;return t?s[t]:[]},getIdsInBatch:function(e){var t=r[e].batchId;return d[t]}})},qqdropbox.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qqdropbox.basePublicApi={addBlobs:function(e,t,o){if(!qqdropbox.supportedFeatures.blobUploading)throw new qqdropbox.Error("Blob uploading is not supported in this browser!");if(e){var n=[].concat(e),r=[],i=0===this._storedIds.length?qqdropbox.getUniqueId():this._currentBatchId,a=this;this._currentBatchId=i,qqdropbox.each(n,function(e,t){var o;qqdropbox.isBlob(t)&&!qqdropbox.isFileOrInput(t)?o={blob:t,name:a._options.blobs.defaultName}:qqdropbox.isObject(t)&&t.blob&&t.name?o=t:a.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error"),o&&a._handleNewFile(o,i,r)}),this._prepareItemsForUpload(r,t,o)}else this.log("undefined or non-array parameter passed into addBlobs","error")},addFiles:function(e,t,o){var n,r,i,a=[],s=0===this._storedIds.length?qqdropbox.getUniqueId():this._currentBatchId;if(this._currentBatchId=s,e){for(qqdropbox.isFileList(e)||(e=[].concat(e)),n=0;n<e.length;n+=1)if(r=e[n],qqdropbox.isFileOrInput(r))if(qqdropbox.isInput(r)&&qqdropbox.supportedFeatures.ajaxUploading)for(i=0;i<r.files.length;i++)this._handleNewFile(r.files[i],s,a);else this._handleNewFile(r,s,a);else this.log(r+" is not a File or INPUT element!  Ignoring!","warn");this.log("Received "+a.length+" files or inputs."),this._prepareItemsForUpload(a,t,o)}},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qqdropbox.extend(e,this._storedIds),qqdropbox.each(e,function(e,o){t.cancel(o)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return qqdropbox.supportedFeatures.pause&&this._options.chunking.enabled?t.status===qqdropbox.status.PAUSED?(this.log(qqdropbox.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qqdropbox.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1):!1},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,o,n){var r=new qqdropbox.Promise;if(this._imageGenerator){var i=this._thumbnailUrls[e],a={scale:o>0,maxSize:o>0?o:null};!n&&qqdropbox.supportedFeatures.imagePreviews&&(i=this.getFile(e)),null==i?r.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(i,t,a).then(function(e){r.success(e)},function(e,t){r.failure({container:e,error:t||"Problem generating thumbnail"})})}else r.failure({container:t,error:"Missing image generator module"});return r},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qqdropbox.status.UPLOADING,qqdropbox.status.UPLOAD_RETRYING,qqdropbox.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),o=null;return t&&void 0!==t.parentId&&(o=t.parentId),o},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._options.validation.itemLimit;return e>0?this._options.validation.itemLimit-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qqdropbox.log("[Fine Uploader "+qqdropbox.version+"] "+e,t):qqdropbox.log("[Fine Uploader "+qqdropbox.version+"] "+e)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qqdropbox.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qqdropbox.indexOf([qqdropbox.status.UPLOADING,qqdropbox.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qqdropbox.status.PAUSED),!0;this.log(qqdropbox.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qqdropbox.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qqdropbox.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var o=this;return qqdropbox.Scaler.prototype.scaleImage(e,t,{log:qqdropbox.bind(o.log,o),getFile:qqdropbox.bind(o.getFile,o),uploadData:o._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setEndpointchunk:function(e,t){this._setEndpointchunk.set(e,t)},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},uploadStoredFiles:function(){var e;if(0===this._storedIds.length)this._itemError("noFilesError");else for(;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e)}},qqdropbox.basePrivateApi={_addCannedFile:function(e){var t=this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qqdropbox.status.UPLOAD_SUCCESSFUL});return e.deleteFileEndpoint&&this.setDeleteFileEndpoint(e.deleteFileEndpoint,t),e.deleteFileParams&&this.setDeleteFileParams(e.deleteFileParams,t),e.thumbnailUrl&&(this._thumbnailUrls[t]=e.thumbnailUrl),this._netUploaded++,this._netUploadedOrQueued++,t},_annotateWithButtonId:function(e,t){qqdropbox.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new qqdropbox.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qqdropbox.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,o,n){e._onDeleteComplete(t,o,n),e._options.callbacks.onDeleteComplete(t,o,n)}})},_createPasteHandler:function(){var e=this;return new qqdropbox.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qqdropbox.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qqdropbox.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qqdropbox.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var o={},n=e,r={},i=function(e){return qqdropbox.isObject(e)?qqdropbox.extend({},e):e},a=function(){return qqdropbox.isFunction(t)?t():t},s=function(e,o){t&&qqdropbox.isObject(o)&&qqdropbox.extend(o,a()),r[e]&&qqdropbox.extend(o,r[e])};return{set:function(e,t){null==t?(o={},n=i(e)):o[t]=i(e)},get:function(e){var t;return t=null!=e&&o[e]?o[e]:i(n),s(e,t),i(t)},addReadOnly:function(e,t){qqdropbox.isObject(o)&&(r[e]=r[e]||{},qqdropbox.extend(r[e],t))},remove:function(e){return delete o[e]},reset:function(){o={},r={},n=e}}},_createUploadDataTracker:function(){var e=this;return new qqdropbox.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,o,n){e._onUploadStatusChange(t,o,n),e._options.callbacks.onStatusChange(t,o,n),e._maybeAllComplete(t,n),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,o,n)},0)}})},_createUploadButton:function(e){function t(){return qqdropbox.supportedFeatures.ajaxUploading?qqdropbox.ios7()&&o._isAllowedExtension(r,".mov")?!1:void 0===e.multiple?o._options.multiple:e.multiple:!1}var o=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions,i=new qqdropbox.UploadButton({element:e.element,folders:e.folders,name:this._options.request.inputName,multiple:t(),acceptFiles:n,onChange:function(e){o._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){i.dispose()}),o._buttons.push(i),i},_createUploadHandler:function(e,t){var o=this,n={},r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qqdropbox.bind(o.log,o),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,r,i){n[e]?(n[e].loaded!==r||n[e].total!==i)&&(o._onProgress(e,t,r,i),o._options.callbacks.onProgress(e,t,r,i)):(o._onProgress(e,t,r,i),o._options.callbacks.onProgress(e,t,r,i)),n[e]={loaded:r,total:i}},onComplete:function(e,t,r,i){delete n[e];var a=o.getUploads({id:e}).status;if(a!==qqdropbox.status.UPLOAD_SUCCESSFUL&&a!==qqdropbox.status.UPLOAD_FAILED){var s=o._onComplete(e,t,r,i);s instanceof qqdropbox.Promise?s.done(function(){o._options.callbacks.onComplete(e,t,r,i)}):o._options.callbacks.onComplete(e,t,r,i)}},onCancel:function(e,t,n){var r=new qqdropbox.Promise;return o._handleCheckedCallback({name:"onCancel",callback:qqdropbox.bind(o._options.callbacks.onCancel,o,e,t),onFailure:r.failure,onSuccess:function(){n.then(function(){o._onCancel(e,t)}),r.success()},identifier:e}),r},onUploadPrep:qqdropbox.bind(this._onUploadPrep,this),onUpload:function(e,t){o._onUpload(e,t),o._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,n){o._onUploadChunk(e,n),o._options.callbacks.onUploadChunk(e,t,n)},onUploadChunkSuccess:function(){o._options.callbacks.onUploadChunkSuccess.apply(o,arguments)},onResume:function(e,t,n){return o._options.callbacks.onResume(e,t,n)},onAutoRetry:function(){return o._onAutoRetry.apply(o,arguments)},onUuidChanged:function(e,t){o.log("Server requested UUID change from '"+o.getUuid(e)+"' to '"+t+"'"),o.setUuid(e,t)},getName:qqdropbox.bind(o.getName,o),getUuid:qqdropbox.bind(o.getUuid,o),getSize:qqdropbox.bind(o.getSize,o),setSize:qqdropbox.bind(o._setSize,o),getDataByUuid:function(e){return o.getUploads({uuid:e})},isQueued:function(e){var t=o.getUploads({id:e}).status;return t===qqdropbox.status.QUEUED||t===qqdropbox.status.SUBMITTED||t===qqdropbox.status.UPLOAD_RETRYING||t===qqdropbox.status.PAUSED},getIdsInProxyGroup:o._uploadData.getIdsInProxyGroup,getIdsInBatch:o._uploadData.getIdsInBatch};return qqdropbox.each(this._options.request,function(e,t){r[e]=t}),r.customHeaders=this._customHeadersStore,e&&qqdropbox.each(e,function(e,t){r[e]=t}),new qqdropbox.UploadHandlerController(r,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qqdropbox.status.REJECTED)},_formatSize:function(e){var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qqdropbox.each(this._options.extraButtons,function(t,o){var n=o.multiple,r=qqdropbox.extend({},e._options.validation,!0),i=qqdropbox.extend({},o);void 0===n&&(n=e._options.multiple),i.validation&&qqdropbox.extend(r,o.validation,!0),qqdropbox.extend(i,{multiple:n,validation:r},!0),e._initExtraButton(i)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var t,o,n=e;if(n instanceof qqdropbox.BlobProxy&&(n=n.referenceBlob),n&&!qqdropbox.isBlob(n)){if(qqdropbox.isFile(n))return n.qqButtonId;if("input"===n.tagName.toLowerCase()&&"file"===n.type.toLowerCase())return n.getAttribute(qqdropbox.UploadButton.BUTTON_ID_ATTR_NAME);if(t=n.getElementsByTagName("input"),qqdropbox.each(t,function(e,t){return"file"===t.getAttribute("type")?(o=t,!1):void 0}),o)return o.getAttribute(qqdropbox.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qqdropbox.status.UPLOADING,qqdropbox.status.UPLOAD_RETRYING,qqdropbox.status.QUEUED,qqdropbox.status.SUBMITTING,qqdropbox.status.SUBMITTED,qqdropbox.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qqdropbox.BlobProxy?{name:qqdropbox.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,o=[];return qqdropbox.each(e,function(e,n){o.push(t._getValidationDescriptor(n))}),o},_handleCameraAccess:function(){if(this._options.camera.ios&&qqdropbox.ios()){var e="image/*;capture=camera",t=this._options.camera.button,o=t?this._getButtonId(t):this._defaultButtonId,n=this._options;o&&o!==this._defaultButtonId&&(n=this._extraButtonSpecs[o]),n.multiple=!1,null===n.validation.acceptFiles?n.validation.acceptFiles=e:n.validation.acceptFiles+=","+e,qqdropbox.each(this._buttons,function(e,t){return t.getButtonId()===o?(t.setMultiple(n.multiple),t.setAcceptFiles(n.acceptFiles),!1):void 0})}},_handleCheckedCallback:function(e){var t=this,o=e.callback();return qqdropbox.isGenericPromise(o)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),o.then(function(o){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(o)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(o!==!1?e.onSuccess(o):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),o)},_handleNewFile:function(e,t,o){var n=this,r=qqdropbox.getUniqueId(),i=-1,a=qqdropbox.getFilename(e),s=e.blob||e,d=this._customNewFileHandler?this._customNewFileHandler:qqdropbox.bind(n._handleNewFileGeneric,n);!qqdropbox.isInput(s)&&s.size>=0&&(i=s.size),d(s,a,r,i,o,t,this._options.request.uuidName,{uploadData:n._uploadData,paramsStore:n._paramsStore,addFileToHandler:function(e,t){n._handler.add(e,t),n._netUploadedOrQueued++,n._trackButton(e)}})},_handleNewFileGeneric:function(e,t,o,n,r,i){var a=this._uploadData.addFile({uuid:o,name:t,size:n,batchId:i});this._handler.add(a,e),this._trackButton(a),this._netUploadedOrQueued++,r.push({id:a,file:e})},_handlePasteSuccess:function(e,t){var o=e.type.split("/")[1],n=t;null==n&&(n=this._options.paste.defaultName),n+="."+o,this.addBlobs({name:n,blob:e})},_initExtraButton:function(e){var t=this._createUploadButton({element:e.element,multiple:e.multiple,accept:e.validation.acceptFiles,folders:e.folders,allowedExtensions:e.validation.allowedExtensions});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qqdropbox.FormSupport&&new qqdropbox.FormSupport(this._options.form,qqdropbox.bind(this.uploadStoredFiles,this),qqdropbox.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)
},_isDeletePossible:function(){return qqdropbox.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?qqdropbox.supportedFeatures.deleteFileCorsXhr?!0:qqdropbox.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(e,t){var o=!1;return e.length?(qqdropbox.each(e,function(e,n){if(qqdropbox.isString(n)){var r=new RegExp("\\."+n+"$","i");if(null!=t.match(r))return o=!0,!1}}),o):!0},_itemError:function(e,t,o){function n(e,t){a=a.replace(e,t)}var r,i,a=this._options.messages[e],s=[],d=[].concat(t),u=d[0],l=this._getButtonId(o),p=this._getValidationBase(l);return qqdropbox.each(p.allowedExtensions,function(e,t){qqdropbox.isString(t)&&s.push(t)}),r=s.join(", ").toLowerCase(),n("{file}",this._options.formatFileName(u)),n("{extensions}",r),n("{sizeLimit}",this._formatSize(p.sizeLimit)),n("{minSizeLimit}",this._formatSize(p.minSizeLimit)),i=a.match(/(\{\w+\})/g),null!==i&&qqdropbox.each(i,function(e,t){n(t,d[e])}),this._options.callbacks.onError(null,u,a,void 0),a},_manualRetry:function(e,t){return this._onBeforeManualRetry(e)?(this._netUploadedOrQueued++,this._uploadData.setStatus(e,qqdropbox.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0):void 0},_maybeAllComplete:function(e,t){var o=this,n=this._getNotFinished();t===qqdropbox.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qqdropbox.status.UPLOAD_FAILED&&this._succeededSinceLastAllComplete.push(e),0===n&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){o._onAllComplete(o._succeededSinceLastAllComplete,o._failedSinceLastAllComplete)},0)},_maybeParseAndSendUploadError:function(e,t,o,n){if(!o.success)if(n&&200!==n.status&&!o.error)this._options.callbacks.onError(e,t,"XHR returned response code "+n.status,n);else{var r=o.error?o.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,r,n)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,o,n,r){var i=this;if(t.length>o)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=i._getValidationDescriptor(t[o]);i._handleCheckedCallback({name:"onValidate",callback:qqdropbox.bind(i._options.callbacks.onValidate,i,t[o].file),onSuccess:qqdropbox.bind(i._onValidateCallbackSuccess,i,t,o,n,r),onFailure:qqdropbox.bind(i._onValidateCallbackFailure,i,t,o,n,r),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;o<t.length;o++)i._fileOrBlobRejected(t[o].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qqdropbox.extend([],e),qqdropbox.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,o,n,r){var i=this;return i._preventRetries[e]=o[i._options.retry.preventRetryResponseProperty],i._shouldAutoRetry(e,t,o)?(i._maybeParseAndSendUploadError.apply(i,arguments),i._options.callbacks.onAutoRetry(e,t,i._autoRetries[e]),i._onBeforeAutoRetry(e,t),i._retryTimeouts[e]=setTimeout(function(){i.log("Retrying "+t+"..."),i._uploadData.setStatus(e,qqdropbox.status.UPLOAD_RETRYING),r?r(e):i._handler.retry(e)},1e3*i._options.retry.autoAttemptDelay),!0):void 0},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e])return this.log("Retries are forbidden for id "+e,"warn"),!1;if(this._handler.isValid(e)){var o=this.getName(e);return this._options.callbacks.onManualRetry(e,o)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+o+"' (id: "+e+")..."),!0)}return this.log("'"+e+"' is not a valid file ID","error"),!1},_onCancel:function(e){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var t=qqdropbox.indexOf(this._storedIds,e);!this._options.autoUpload&&t>=0&&this._storedIds.splice(t,1),this._uploadData.setStatus(e,qqdropbox.status.CANCELED)},_onComplete:function(e,t,o,n){return o.success?(o.thumbnailUrl&&(this._thumbnailUrls[e]=o.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qqdropbox.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qqdropbox.status.UPLOAD_FAILED),o[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,o,n),o.success?!0:!1},_onDelete:function(e){this._uploadData.setStatus(e,qqdropbox.status.DELETING)},_onDeleteComplete:function(e,t,o){var n=this.getName(e);o?(this._uploadData.setStatus(e,qqdropbox.status.DELETE_FAILED),this.log("Delete request for '"+n+"' has failed.","error"),void 0===t.withCredentials?this._options.callbacks.onError(e,n,"Delete request failed",t):this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qqdropbox.status.DELETED),this.log("Delete request for '"+n+"' has succeeded."))},_onInputChange:function(e){var t;if(qqdropbox.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qqdropbox.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,o,n){this._totalProgress&&this._totalProgress.onIndividualProgress(e,o,n)},_onSubmit:function(){},_onSubmitCallbackSuccess:function(e){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qqdropbox.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._uploadFile(e):this._storeForLater(e)},_onSubmitDelete:function(e,t,o){var n,r=this.getUuid(e);return t&&(n=qqdropbox.bind(t,this,e,r,o)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qqdropbox.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:n||qqdropbox.bind(this._deleteHandler.sendDelete,this,e,r,o),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(){},_onUpload:function(e){this._uploadData.setStatus(e,qqdropbox.status.UPLOADING)},_onUploadChunk:function(){},_onUploadStatusChange:function(e,t,o){o===qqdropbox.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qqdropbox.each(e,function(e,o){t._fileOrBlobRejected(o.id)})},_onValidateBatchCallbackSuccess:function(e,t,o,n,r){var i,a=this._options.validation.itemLimit,s=this._netUploadedOrQueued;0===a||a>=s?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qqdropbox.bind(this._options.callbacks.onValidate,this,e[0],r),onSuccess:qqdropbox.bind(this._onValidateCallbackSuccess,this,t,0,o,n),onFailure:qqdropbox.bind(this._onValidateCallbackFailure,this,t,0,o,n),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),i=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,s).replace(/\{itemLimit\}/g,a),this._batchError(i))},_onValidateCallbackFailure:function(e,t,o,n){var r=t+1;this._fileOrBlobRejected(e[0].id,e[0].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,o,n)},_onValidateCallbackSuccess:function(e,t,o,n){var r=this,i=t+1,a=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],a).then(function(){r._upload(e[t].id,o,n),r._maybeProcessNextItemAfterOnValidateCallback(!0,e,i,o,n)},function(){r._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,o,n)})},_prepareItemsForUpload:function(e,t,o){if(0===e.length)return void this._itemError("noFilesError");var n=this._getValidationDescriptors(e),r=this._getButtonId(e[0].file),i=this._getButton(r);this._handleCheckedCallback({name:"onValidateBatch",callback:qqdropbox.bind(this._options.callbacks.onValidateBatch,this,n,i),onSuccess:qqdropbox.bind(this._onValidateBatchCallbackSuccess,this,n,e,t,o,i),onFailure:qqdropbox.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){return e.getInProgress()?(t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave):void 0})},_refreshSessionData:function(){var e=this,t=this._options.session;qqdropbox.Session&&null!=this._options.session.endpoint&&(this._session||(qqdropbox.extend(t,this._options.cors),t.log=qqdropbox.bind(this.log,this),t.addFileRecord=qqdropbox.bind(this._addCannedFile,this),this._session=new qqdropbox.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,o){e._options.callbacks.onSessionRequestComplete(t,!0,o)},function(t,o){e._options.callbacks.onSessionRequestComplete(t,!1,o)})},0))},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var t=this._uploadData.retrieve({id:e});return!this._preventRetries[e]&&this._options.retry.enableAuto&&t.status!==qqdropbox.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts)?(this._autoRetries[e]+=1,!0):!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;t=qqdropbox.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_upload:function(e,t,o){var n=this.getName(e);t&&this.setParams(t,e),o&&this.setEndpoint(o,e),this._handleCheckedCallback({name:"onSubmit",callback:qqdropbox.bind(this._options.callbacks.onSubmit,this,e,n),onSuccess:qqdropbox.bind(this._onSubmitCallbackSuccess,this,e,n),onFailure:qqdropbox.bind(this._fileOrBlobRejected,this,e,n),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qqdropbox.status.QUEUED)},_validateFileOrBlobData:function(e,t){var o=this,n=function(){return e.file instanceof qqdropbox.BlobProxy?e.file.referenceBlob:e.file}(),r=t.name,i=t.size,a=this._getButtonId(e.file),s=this._getValidationBase(a),d=new qqdropbox.Promise;return d.then(function(){},function(){o._fileOrBlobRejected(e.id,r)}),qqdropbox.isFileOrInput(n)&&!this._isAllowedExtension(s.allowedExtensions,r)?(this._itemError("typeError",r,n),d.failure()):0===i?(this._itemError("emptyError",r,n),d.failure()):i>0&&s.sizeLimit&&i>s.sizeLimit?(this._itemError("sizeError",r,n),d.failure()):i>0&&i<s.minSizeLimit?(this._itemError("minSizeError",r,n),d.failure()):(qqdropbox.ImageValidation&&qqdropbox.supportedFeatures.imagePreviews&&qqdropbox.isFile(n)?new qqdropbox.ImageValidation(n,qqdropbox.bind(o.log,o)).validate(s.image).then(d.success,function(e){o._itemError(e+"ImageError",r,n),d.failure()}):d.success(),d)},_wrapCallbacks:function(){var e,t;e=this,t=function(t,o,n){var r;try{return o.apply(e,n)}catch(i){r=i.message||i.toString(),e.log("Caught exception in '"+t+"' callback - "+r,"error")}};for(var o in this._options.callbacks)!function(){var n,r;n=o,r=e._options.callbacks[n],e._options.callbacks[n]=function(){return t(n,r,arguments)}}()}}}(),function(){"use strict";qqdropbox.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0}},callbacks:{onSubmit:function(){},onSubmitted:function(){},onComplete:function(){},onAllComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onUploadChunkSuccess:function(){},onResume:function(){},onProgress:function(){},onTotalProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidateBatch:function(){},onValidate:function(){},onSubmitDelete:function(){},onDelete:function(){},onDeleteComplete:function(){},onPasteReceived:function(){},onStatusChange:function(){},onSessionRequestComplete:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return void 0!==e&&e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-14)),e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]}},qqdropbox.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qqdropbox.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qqdropbox.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qqdropbox.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qqdropbox.ImageGenerator&&new qqdropbox.ImageGenerator(qqdropbox.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qqdropbox.Scaler&&new qqdropbox.Scaler(this._options.scaling,qqdropbox.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qqdropbox.bind(this._scaler.handleNewFile,this._scaler)),qqdropbox.TotalProgress&&qqdropbox.supportedFeatures.progressBar&&(this._totalProgress=new qqdropbox.TotalProgress(qqdropbox.bind(this._onTotalProgress,this),function(e){var o=t._uploadData.retrieve({id:e});return o&&o.size||0}))},qqdropbox.FineUploaderBasic.prototype=qqdropbox.basePublicApi,qqdropbox.extend(qqdropbox.FineUploaderBasic.prototype,qqdropbox.basePrivateApi)}(),qqdropbox.AjaxRequester=function(e){"use strict";function t(){return qqdropbox.indexOf(["GET","PUT","HEAD"],y.method)>=0}function o(){var e=!1;return qqdropbox.each(e,function(t,o){return qqdropbox.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],o)<0?(e=!0,!1):void 0}),e}function n(e){return y.cors.expected&&void 0===e.withCredentials}function r(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&(e=qqdropbox.createXhrInstance(),void 0===e.withCredentials&&(e=new XDomainRequest)),e}function i(e,t){var o=v[e].xhr;return o||(o=t?t:y.cors.expected?r():qqdropbox.createXhrInstance(),v[e].xhr=o),o}function a(e){var t,o=qqdropbox.indexOf(_,e),n=y.maxConnections;delete v[e],_.splice(o,1),_.length>=n&&n>o&&(t=_[n-1],u(t))}function s(e,t){var o=i(e),r=y.method,s=t===!0;a(e),s?g(r+" request for "+e+" has failed","error"):n(o)||m(o.status)||(s=!0,g(r+" request for "+e+" has failed - response code "+o.status,"error")),y.onComplete(e,o,s)}function d(e){var t,o=v[e].additionalParams,n=y.mandatedParams;return y.paramsStore.get&&(t=y.paramsStore.get(e)),o&&qqdropbox.each(o,function(e,o){t=t||{},t[e]=o}),n&&qqdropbox.each(n,function(e,o){t=t||{},t[e]=o}),t}function u(e,t){var o,r=i(e,t),a=y.method,s=d(e),u=v[e].payload;return y.onSend(e),o=l(e,s),n(r)?(r.onload=h(e),r.onerror=f(e)):r.onreadystatechange=p(e),c(e),r.open(a,o,!0),y.cors.expected&&y.cors.sendCredentials&&!n(r)&&(r.withCredentials=!0),q(e),g("Sending "+a+" request for "+e),u?r.send(u):x||!s?r.send():r.send(s&&y.contentType&&y.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?qqdropbox.obj2url(s,""):s&&y.contentType&&y.contentType.toLowerCase().indexOf("application/json")>=0?JSON.stringify(s):s),r}function l(e,t){var o=y.endpointStore.get(e),n=v[e].addToPath;return void 0!=n&&(o+="/"+n),x&&t?qqdropbox.obj2url(t,o):o}function p(e){return function(){4===i(e).readyState&&s(e)}}function c(e){var t=y.onProgress;t&&(i(e).upload.onprogress=function(o){o.lengthComputable&&t(e,o.loaded,o.total)})}function h(e){return function(){s(e)}}function f(e){return function(){s(e,!0)}}function q(e){var r=i(e),a=y.customHeaders,s=v[e].additionalHeaders||{},d=y.method,u={};n(r)||(y.acceptHeader&&r.setRequestHeader("Accept",y.acceptHeader),y.allowXRequestedWithAndCacheControl&&(y.cors.expected&&t()&&!o(a)||(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"))),!y.contentType||"PUT"!==d&&"PUT"!==d||r.setRequestHeader("Content-Type",y.contentType),qqdropbox.extend(u,qqdropbox.isFunction(a)?a(e):a),qqdropbox.extend(u,s),qqdropbox.each(u,function(e,t){r.setRequestHeader(e,t)}))}function m(e){return qqdropbox.indexOf(y.successfulResponseCodes[y.method],e)>=0}function b(e,t,o,n,r,i){v[e]={addToPath:o,additionalParams:n,additionalHeaders:r,payload:i};var a=_.push(e);return a<=y.maxConnections?u(e,t):void 0}var g,x,_=[],v={},y={acceptHeader:null,validMethods:["PUT"],method:"PUT",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PUT:[200,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(){},onSend:function(){},onComplete:function(){},onProgress:null};if(qqdropbox.extend(y,e),g=y.log,qqdropbox.indexOf(y.validMethods,y.method)<0)throw new Error("'"+y.method+"' is not a supported method for this type of request!");x="GET"===y.method||"DELETE"===y.method,qqdropbox.extend(this,{initTransport:function(e){var t,o,n,r,i;return{withPath:function(e){return t=e,this},withParams:function(e){return o=e,this},withHeaders:function(e){return n=e,this},withPayload:function(e){return r=e,this},withCacheBuster:function(){return i=!0,this},send:function(a){return i&&qqdropbox.indexOf(["GET","DELETE"],y.method)>=0&&(o.qqtimestamp=(new Date).getTime()),b(e,a,t,o,n,r)}}},canceled:function(e){a(e)}})},qqdropbox.UploadHandler=function(e){"use strict";var t=e.proxy,o={},n=t.onCancel,r=t.getName;qqdropbox.extend(this,{add:function(e,t){o[e]=t,o[e].temp={}},cancel:function(e){var t=this,i=new qqdropbox.Promise,a=n(e,r(e),i);a.then(function(){t.isValid(e)&&(o[e].canceled=!0,t.expunge(e)),i.success()})},expunge:function(e){delete o[e]},getThirdPartyFileId:function(e){return o[e].key},isValid:function(e){return void 0!==o[e]},reset:function(){o={}},_getFileState:function(e){return o[e]},_setThirdPartyFileId:function(e,t){o[e].key=t},_wasCanceled:function(e){return!!o[e].canceled}})},qqdropbox.UploadHandlerController=function(e,t){"use strict";var o,n,r,i=this,a=!1,s=!1,d={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUploadPrep:function(){},onUpload:function(){},onUploadChunk:function(){},onUploadChunkSuccess:function(){},onAutoRetry:function(){},onResume:function(){},onUuidChanged:function(){},getName:function(){},setSize:function(){},isQueued:function(){},getIdsInProxyGroup:function(){},getIdsInBatch:function(){}},u={done:function(e,t,o,n){var i=r._getChunkData(e,t);r._getFileState(e).attemptingResume=!1,delete r._getFileState(e).temp.chunkProgress[t],r._getFileState(e).loaded+=i.size,d.onUploadChunkSuccess(e,r._getChunkDataForCallback(i),o,n)},finalize:function(e,t){var o=d.getSize(e),i=d.getName(e),a=d.customHeaders.get(e),s=new XMLHttpRequest;s.open("POST","https://api-content.dropbox.com/1/commit_chunked_upload/auto/"+d.path+i+"?upload_id="+JSON.parse(t.responseText).upload_id,!0),s.setRequestHeader("Authorization",a.Authorization),s.send(),n("All chunks have been uploaded for "+e+" - finalizing...."),r.finalizeChunks(e).then(function(t,a){n("Finalize successful for "+e);var s=c.normalizeResponse(t,!0);d.onProgress(e,i,o,o),r._maybeDeletePersistedChunkData(e),c.cleanup(e,s,a)},function(t,o){var r=c.normalizeResponse(t,!1);n("Problem finalizing chunks for file ID "+e+" - "+r.error,"error"),r.reset&&u.reset(e),d.onAutoRetry(e,i,r,o)||c.cleanup(e,r,o)})},hasMoreParts:function(e){return!!r._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=r._getFileState(e).chunking.remaining.shift();return t>=r._getTotalChunks(e)&&(t=null),t},reset:function(e){n("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),r._maybeDeletePersistedChunkData(e),r.reevaluateChunking(e),r._getFileState(e).loaded=0},sendNext:function(e,t){var o=d.getSize(e),i=d.getName(e),a=u.nextPart(e),p=r._getChunkData(e,a),h=r._getFileState(e).attemptingResume,f=r._getFileState(e).chunking.inProgress||[];null==r._getFileState(e).loaded&&(r._getFileState(e).loaded=0),h&&d.onResume(e,i,p)===!1&&(u.reset(e),a=u.nextPart(e),p=r._getChunkData(e,a),h=!1),null==a&&0===f.length?u.finalize(e):(n("Sending chunked upload request for item "+e+": bytes "+(p.start+1)+"-"+p.end+" of "+o),d.onUploadChunk(e,i,r._getChunkDataForCallback(p)),f.push(a),r._getFileState(e).chunking.inProgress=f,s&&l.open(e,a),s&&l.available()&&r._getFileState(e).chunking.remaining.length&&u.sendNext(e,t),r.uploadChunk(e,a,h,t).then(function(t,o){n("Chunked upload request succeeded for "+e+", chunk "+a),r.clearCachedChunk(e,a);var i=r._getFileState(e).chunking.inProgress||[],s=c.normalizeResponse(t,!0),d=qqdropbox.indexOf(i,a);n(qqdropbox.format("Chunk {} for file {} uploaded successfully.",a,e)),u.done(e,a,s,o),d>=0&&i.splice(d,1),r._maybePersistChunkedState(e),u.hasMoreParts(e)||0!==i.length?u.hasMoreParts(e)&&u.sendNext(e,o):u.finalize(e,o)},function(t,o){n("Chunked upload request failed for "+e+", chunk "+a),r.clearCachedChunk(e,a);var p=c.normalizeResponse(t,!1);if(p.reset)u.reset(e);else{var h=qqdropbox.indexOf(r._getFileState(e).chunking.inProgress,a);h>=0&&(r._getFileState(e).chunking.inProgress.splice(h,1),r._getFileState(e).chunking.remaining.unshift(a))}r._getFileState(e).temp.ignoreFailure||(s&&(r._getFileState(e).temp.ignoreFailure=!0,qqdropbox.each(r._getXhrs(e),function(e,t){t.abort()}),r.moveInProgressToRemaining(e),l.free(e,!0)),d.onAutoRetry(e,i,p,o)||c.cleanup(e,p,o))}).done(function(){r.clearXhr(e,a)}))}},l={_open:[],_openChunks:{},_waiting:[],available:function(){var e=d.maxConnections,t=0,o=0;return qqdropbox.each(l._openChunks,function(e,n){t++,o+=n.length}),e-(l._open.length-t+o)},free:function(e,t){var o,i=!t,a=qqdropbox.indexOf(l._waiting,e),s=qqdropbox.indexOf(l._open,e);delete l._openChunks[e],c.getProxyOrBlob(e)instanceof qqdropbox.BlobProxy&&(n("Generated blob upload has ended for "+e+", disposing generated blob."),delete r._getFileState(e).file),a>=0?l._waiting.splice(a,1):i&&s>=0&&(l._open.splice(s,1),o=l._waiting.shift(),o>=0&&(l._open.push(o),c.start(o)))},getWaitingOrConnected:function(){var e=[];return qqdropbox.each(e,l._open),qqdropbox.each(e,l._waiting)},isUsingConnection:function(e){return qqdropbox.indexOf(l._open,e)>=0},open:function(e,t){return null==t&&l._waiting.push(e),l.available()?(null==t?(l._waiting.pop(),l._open.push(e)):!function(){var o=l._openChunks[e]||[];o.push(t),l._openChunks[e]=o}(),!0):!1},reset:function(){l._waiting=[],l._open=[]}},p={send:function(e,t){r._getFileState(e).loaded=0,n("Sending simple upload request for "+e),r.uploadFile(e).then(function(o,r){n("Simple upload request succeeded for "+e);var i=d.customHeaders.get(e),a=new XMLHttpRequest;a.open("POST","https://api-content.dropbox.com/1/commit_chunked_upload/auto/"+d.path+t+"?upload_id="+JSON.parse(r.responseText).upload_id,!0),a.setRequestHeader("Authorization",i.Authorization),a.send();var s=c.normalizeResponse(o,!0),u=d.getSize(e);d.onProgress(e,t,u,u),c.maybeNewUuid(e,s),c.cleanup(e,s,r)},function(o,r){n("Simple upload request failed for "+e);var i=c.normalizeResponse(o,!1);d.onAutoRetry(e,t,i,r)||c.cleanup(e,i,r)})}},c={cancel:function(e){n("Cancelling "+e),d.paramsStore.remove(e),l.free(e)},cleanup:function(e,t,o){var n=d.getName(e);d.onComplete(e,n,t,o),r._getFileState(e)&&r._clearXhrs&&r._clearXhrs(e),l.free(e)},getProxyOrBlob:function(e){return r.getProxy&&r.getProxy(e)||r.getFile&&r.getFile(e)},initHandler:function(){var e=t?qq[t]:qqdropbox.traditional,o=qqdropbox.supportedFeatures.ajaxUploading?"Xhr":"Form";r=new e[o+"UploadHandler"](d,{getDataByUuid:d.getDataByUuid,getName:d.getName,getSize:d.getSize,getUuid:d.getUuid,log:n,onCancel:d.onCancel,onProgress:d.onProgress,onUuidChanged:d.onUuidChanged}),r._removeExpiredChunkingRecords&&r._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return d.isQueued(e)},maybeDefer:function(e,t){return t&&!r.getFile(e)&&t instanceof qqdropbox.BlobProxy?(d.onUploadPrep(e),n("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){n("Generated an on-demand blob for "+e),r.updateBlob(e,t),d.setSize(e,t.size),r.reevaluateChunking(e),c.maybeSendDeferredFiles(e)},function(t){var r={};t&&(r.error=t),n(qqdropbox.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),d.onComplete(e,d.getName(e),qqdropbox.extend(r,o),null),c.maybeSendDeferredFiles(e),l.free(e)}),!1):c.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=d.getIdsInProxyGroup(e),o=!1;return t&&t.length?(n("Maybe ready to upload proxy group file "+e),qqdropbox.each(t,function(t,n){if(c.isDeferredEligibleForUpload(n)&&r.getFile(n))o=n===e,c.now(n);else if(c.isDeferredEligibleForUpload(n))return!1})):(o=!0,c.now(e)),o},maybeNewUuid:function(e,t){void 0!==t.newUuid&&d.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var o=e;return qqdropbox.isObject(e)||(o={},qqdropbox.isString(e)&&!t&&(o.error=e)),o.success=t,o},now:function(e){var t=d.getName(e);if(!i.isValid(e))throw new qqdropbox.Error(e+" is not a valid file ID to upload!");d.onUpload(e,t),a&&r._shouldChunkThisFile(e)?u.sendNext(e,""):p.send(e,t)},start:function(e){var t=c.getProxyOrBlob(e);return t?c.maybeDefer(e,t):(c.now(e),!0)}};qqdropbox.extend(this,{add:function(){r.add.apply(this,arguments)},upload:function(e){return l.open(e)?c.start(e):!1},retry:function(e){return s&&(r._getFileState(e).temp.ignoreFailure=!1),l.isUsingConnection(e)?c.start(e):i.upload(e)},cancel:function(e){var t=r.cancel(e);qqdropbox.isGenericPromise(t)?t.then(function(){c.cancel(e)}):t!==!1&&c.cancel(e)},cancelAll:function(){var e=l.getWaitingOrConnected();qqdropbox.each(e,function(e,t){i.cancel(t)}),l.reset()},getFile:function(e){return r.getProxy&&r.getProxy(e)?r.getProxy(e).referenceBlob:r.getFile&&r.getFile(e)},isProxied:function(e){return!(!r.getProxy||!r.getProxy(e))},getInput:function(e){return r.getInput?r.getInput(e):void 0},reset:function(){n("Resetting upload handler"),i.cancelAll(),l.reset(),r.reset()},expunge:function(e){return i.isValid(e)?r.expunge(e):void 0},isValid:function(e){return r.isValid(e)},getResumableFilesData:function(){return r.getResumableFilesData?r.getResumableFilesData():[]},getThirdPartyFileId:function(e){return i.isValid(e)?r.getThirdPartyFileId(e):void 0},pause:function(e){return i.isResumable(e)&&r.pause&&i.isValid(e)&&r.pause(e)?(l.free(e),r.moveInProgressToRemaining(e),!0):!1},isResumable:function(e){return!!r.isResumable&&r.isResumable(e)}}),qqdropbox.extend(d,e),n=d.log,a=d.chunking.enabled&&qqdropbox.supportedFeatures.chunking,s=a&&d.chunking.concurrent.enabled,o=function(){var e={};return e[d.preventRetryParam]=!0,e}(),c.initHandler()},qqdropbox.FormUploadHandler=function(e){"use strict";function t(e){delete l[e],c&&(clearTimeout(p[e]),delete p[e],m.stopReceivingMessages(e));var t=document.getElementById(a._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qqdropbox(t).remove())}function o(e){return e.split("_")[0]}function n(e){var t=qqdropbox.toElement("<iframe src='javascript:false;' name='"+e+"' />");return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}function r(e,t){var n=e.id,r=o(n),i=f(r);u[i]=t,l[r]=qqdropbox(e).attach("load",function(){a.getInput(r)&&(q("Received iframe load event for CORS upload request (iframe name "+n+")"),p[n]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+n;q(e,"error"),t({error:e})},1e3))}),m.receiveMessage(n,function(e){q("Received the following window message: '"+e+"'");var t,r=o(n),i=a._parseJsonResponse(r,e),s=i.uuid;s&&u[s]?(q("Handling response for iframe name "+n),clearTimeout(p[n]),delete p[n],a._detachLoadEvent(n),t=u[s],delete u[s],m.stopReceivingMessages(n),t(i)):s||q("'"+e+"' does not contain a UUID - ignoring.")})}var i=e.options,a=this,s=e.proxy,d=qqdropbox.getUniqueId(),u={},l={},p={},c=i.isCors,h=i.inputName,f=s.getUuid,q=s.log,m=new qqdropbox.WindowReceiveMessage({log:q});qqdropbox.extend(this,new qqdropbox.UploadHandler(e)),qqdropbox.override(this,function(e){return{add:function(t,o){e.add(t,{input:o}),o.setAttribute("name",h),o.parentNode&&qqdropbox(o).remove()},expunge:function(o){t(o),e.expunge(o)},isValid:function(t){return e.isValid(t)&&void 0!==a._getFileState(t).input}}}),qqdropbox.extend(this,{_attachLoadEvent:function(e,t){var o;c?r(e,t):l[e.id]=qqdropbox(e).attach("load",function(){if(q("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return
}catch(n){q("Error when attempting to access iframe during handling of upload response ("+n.message+")","error"),o={success:!1}}t(o)}})},_createIframe:function(e){var t=a._getIframeName(e);return n(t)},_detachLoadEvent:function(e){void 0!==l[e]&&(l[e](),delete l[e])},_getIframeName:function(e){return e+"_"+d},getInput:function(e){return a._getFileState(e).input},_initFormForUpload:function(e){var t=e.method,o=e.endpoint,n=e.params,r=e.paramsInBody,i=e.targetName,a=qqdropbox.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),s=o;return r?qqdropbox.obj2Inputs(n,a):s=qqdropbox.obj2url(n,o),a.setAttribute("action",s),a.setAttribute("target",i),a.style.display="none",document.body.appendChild(a),a}})},qqdropbox.XhrUploadHandler=function(e){"use strict";function t(e){qqdropbox.each(o._getXhrs(e),function(t,n){var r=o._getAjaxRequester(e,t);n.onreadystatechange=null,n.upload.onprogress=null,n.abort(),r&&r.canceled&&r.canceled(e)})}var o=this,n=e.options.namespace,r=e.proxy,i=e.options.chunking,a=e.options.resume,s=i&&e.options.chunking.enabled&&qqdropbox.supportedFeatures.chunking,d=a&&e.options.resume.enabled&&s&&qqdropbox.supportedFeatures.resume,u=r.getName,l=r.getSize,p=r.getUuid,c=r.getEndpoint,h=r.getDataByUuid,f=r.onUuidChanged,q=r.onProgress,m=r.log;qqdropbox.extend(this,new qqdropbox.UploadHandler(e)),qqdropbox.override(this,function(e){return{add:function(t,n){if(qqdropbox.isFile(n)||qqdropbox.isBlob(n))e.add(t,{file:n});else{if(!(n instanceof qqdropbox.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(t,{proxy:n})}o._initTempState(t),d&&o._maybePrepareForResume(t)},expunge:function(n){t(n),o._maybeDeletePersistedChunkData(n),o._clearXhrs(n),e.expunge(n)}}}),qqdropbox.extend(this,{clearCachedChunk:function(e,t){delete o._getFileState(e).temp.cachedChunks[t]},clearXhr:function(e,t){var n=o._getFileState(e).temp;n.xhrs&&delete n.xhrs[t],n.ajaxRequesters&&delete n.ajaxRequesters[t]},finalizeChunks:function(e,t){var n=o._getTotalChunks(e)-1,r=o._getXhr(e,n);return t?(new qqdropbox.Promise).success(t(r),r):(new qqdropbox.Promise).success({},r)},getFile:function(e){return o.isValid(e)&&o._getFileState(e).file},getProxy:function(e){return o.isValid(e)&&o._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return o._iterateResumeRecords(function(t,n){o.moveInProgressToRemaining(null,n.chunking.inProgress,n.chunking.remaining);var r={name:n.name,remaining:n.chunking.remaining,size:n.size,uuid:n.uuid};n.key&&(r.key=n.key),e.push(r)}),e},isResumable:function(e){return!!i&&o.isValid(e)&&!o._getFileState(e).notResumable},moveInProgressToRemaining:function(e,t,n){var r=t||o._getFileState(e).chunking.inProgress,i=n||o._getFileState(e).chunking.remaining;r&&(r.reverse(),qqdropbox.each(r,function(e,t){i.unshift(t)}),r.length=0)},pause:function(e){return o.isValid(e)?(m(qqdropbox.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,u(e))),o._getFileState(e).paused=!0,t(e),!0):void 0},reevaluateChunking:function(e){if(i&&o.isValid(e)){var t,n=o._getFileState(e);if(delete n.chunking,n.chunking={},t=o._getTotalChunks(e),t>1){n.chunking.enabled=!0,n.chunking.parts=t,n.chunking.remaining=[];for(var r=0;t>r;r++)n.chunking.remaining.push(r);o._initTempState(e)}else n.chunking.enabled=!1}},updateBlob:function(e,t){o.isValid(e)&&(o._getFileState(e).file=t)},_clearXhrs:function(e){var t=o._getFileState(e).temp;qqdropbox.each(t.ajaxRequesters,function(e){delete t.ajaxRequesters[e]}),qqdropbox.each(t.xhrs,function(e){delete t.xhrs[e]})},_createXhr:function(e,t){return o._registerXhr(e,t,qqdropbox.createXhrInstance())},_getAjaxRequester:function(e,t){var n=null==t?-1:t;return o._getFileState(e).temp.ajaxRequesters[n]},_getChunkData:function(e,t){var n=i.partSize,r=l(e),a=o.getFile(e),s=n*t,d=s+n>=r?r:s+n,u=o._getTotalChunks(e),p=this._getFileState(e).temp.cachedChunks,c=p[t]||qqdropbox.sliceBlob(a,s,d);return p[t]=c,{part:t,start:s,end:d,count:u,blob:c,size:d-s}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t="5.0",o=u(e),r=l(e),a=i.partSize,s=c(e);return qqdropbox.format("qq{}resume{}-{}-{}-{}-{}",n,t,o,r,a,s)},_getMimeType:function(e){return o.getFile(e).type},_getPersistableData:function(e){return o._getFileState(e).chunking},_getTotalChunks:function(e){if(i){var t=l(e),o=i.partSize;return Math.ceil(t/o)}},_getXhr:function(e,t){var n=null==t?-1:t;return o._getFileState(e).temp.xhrs[n]},_getXhrs:function(e){return o._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){d&&qqdropbox.each(localStorage,function(t,o){if(0===t.indexOf(qqdropbox.format("qq{}resume-",n))){var r=JSON.parse(o);e(t,r)}})},_initTempState:function(e){o._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){o._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var t;return d&&o.isResumable(e)&&(t=o._getLocalStorageId(e),t&&localStorage.getItem(t))?(localStorage.removeItem(t),!0):!1},_maybePrepareForResume:function(e){var t,n,r=o._getFileState(e);d&&void 0===r.key&&(t=o._getLocalStorageId(e),n=localStorage.getItem(t),n&&(n=JSON.parse(n),h(n.uuid)?o._markNotResumable(e):(m(qqdropbox.format("Identified file with ID {} and name of {} as resumable.",e,u(e))),f(e,n.uuid),r.key=n.key,r.chunking=n.chunking,r.loaded=n.loaded,r.attemptingResume=!0,o.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var t,n,r=o._getFileState(e);d&&o.isResumable(e)&&(t=o._getLocalStorageId(e),n={name:u(e),size:l(e),uuid:p(e),key:r.key,chunking:r.chunking,loaded:r.loaded,lastUpdated:Date.now()},localStorage.setItem(t,JSON.stringify(n)))},_registerProgressHandler:function(e,t,n){var r=o._getXhr(e,t),i={simple:function(t,o){var n=l(e);t===o?q(e,name,n,n):q(e,name,t>=n?n-1:t,n)},chunked:function(r,i){var a=o._getFileState(e).temp.chunkProgress,s=o._getFileState(e).loaded,d=r,u=i,p=l(e),c=d-(u-n),h=s;a[t]=c,qqdropbox.each(a,function(e,t){h+=t}),q(e,name,h,p)}};r.upload.onprogress=function(e){if(e.lengthComputable){var t=null==n?"simple":"chunked";i[t](e.loaded,e.total)}}},_registerXhr:function(e,t,n,r){var i=null==t?-1:t,a=o._getFileState(e).temp;return a.xhrs=a.xhrs||{},a.ajaxRequesters=a.ajaxRequesters||{},a.xhrs[i]=n,r&&(a.ajaxRequesters[i]=r),n},_removeExpiredChunkingRecords:function(){var e=a.recordsExpireIn;o._iterateResumeRecords(function(t,o){var n=new Date(o.lastUpdated);n.setDate(n.getDate()+e),n.getTime()<=Date.now()&&(m("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var t=o._getFileState(e);return t.chunking||o.reevaluateChunking(e),t.chunking.enabled}})},qqdropbox.WindowReceiveMessage=function(e){"use strict";var t={log:function(){}},o={};qqdropbox.extend(t,e),qqdropbox.extend(this,{receiveMessage:function(e,t){var n=function(e){t(e.data)};window.postMessage?o[e]=qqdropbox(window).attach("message",n):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=o[e];t&&t()}}})},function(){"use strict";qqdropbox.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){return this._dnd?this._dnd.removeDropzone(e):void 0},getItemByFileId:function(e){return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var o=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,o)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}},qqdropbox.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qqdropbox.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qqdropbox.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,o=this._templating,n=o.getDropZone();return n&&t.push(n),new qqdropbox.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){o.showDropProcessing()},processingDroppedFilesComplete:function(t,n){o.hideDropProcessing(),qqdropbox.each(t,function(e,t){t.qqDropTarget=n}),t.length&&e.addFiles(t,null,null)},dropError:function(t,o){e._itemError(t,o)},dropLog:function(t,o){e.log(t,o)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qqdropbox.FileButtonsClickHandler({templating:this._templating,log:function(t,o){e.log(t,o)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){qqdropbox(e._templating.getFileContainer(t)).removeClass(e._classes.retryable),e._templating.hideRetry(t),e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qqdropbox.FilenameClickHandler&&qqdropbox.FilenameInputFocusHandler&&qqdropbox.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,o){e.log(t,o)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,o){e.setName(t,o)},onEditingStatusChange:function(e,o){var n=qqdropbox(t.getEditInput(e)),r=qqdropbox(t.getFileContainer(e));o?(n.addClass("qq-editing"),t.hideFilename(e),t.hideEditIcon(e)):(n.removeClass("qq-editing"),t.showFilename(e),t.showEditIcon(e)),r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,o){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&o!==qqdropbox.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e))},_bindFilenameInputFocusInEvent:function(){var e=qqdropbox.extend({},this._filenameEditHandler());return new qqdropbox.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qqdropbox.extend({},this._filenameEditHandler());return new qqdropbox.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qqdropbox.extend({},this._filenameEditHandler());return new qqdropbox.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var o=this.getFile(e);o&&o.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:o.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,o,n){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,o,n),100===Math.round(o/n*100)?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,o,n)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,o){function n(t){a&&(i.setStatusText(e),qqdropbox(a).removeClass(s._classes.retrying),i.hideProgress(e),(!s._options.disableCancelForFormUploads||qqdropbox.supportedFeatures.ajaxUploading)&&i.hideCancel(e),i.hideSpinner(e),t.success?s._markFileAsSuccessful(e):(qqdropbox(a).addClass(s._classes.fail),i.isRetryPossible()&&!s._preventRetries[e]&&(qqdropbox(a).addClass(s._classes.retryable),i.showRetry(e)),s._controlFailureTextDisplay(e,t)))}var r=this._parent.prototype._onComplete.apply(this,arguments),i=this._templating,a=i.getFileContainer(e),s=this;return r instanceof qqdropbox.Promise?r.done(function(e){n(e)}):n(o),r},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qqdropbox(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e){var t=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),t},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,o,n;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],o=this._options.retry.maxAutoAttempts,n=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t),n=n.replace(/\{maxAuto\}/g,o),this._templating.setStatusText(e,n),qqdropbox(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qqdropbox(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qqdropbox(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qqdropbox.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,o){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),o?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e){var t,o=this.getName(e),n=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,o),r=(this.getUuid(e),arguments),i=this;t=this._options.showConfirm(n),qqdropbox.isGenericPromise(t)?t.then(function(){i._sendDeleteRequest.apply(i,r)}):t!==!1&&i._sendDeleteRequest.apply(i,r)},_addToList:function(e,t,o){var n,r=0,i=this._handler.isProxied(e)&&this._options.scaling.hideScaled;i||(this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(r=this._filesInBatchAddedToUi-1),n={index:r}),o||(this._options.disableCancelForFormUploads&&!qqdropbox.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(this._handler.cancelAll(),this._clearList())),this._templating.addFile(e,this._options.formatFileName(t),n),o?this._thumbnailUrls[e]&&this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0):this._templating.generatePreview(e,this.getFile(e)),this._filesInBatchAddedToUi+=1,(o||this._options.display.fileSizeOnSubmit&&qqdropbox.supportedFeatures.ajaxUploading)&&this._displayFileSize(e))},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,o){var n=this.getSize(e),r=this._formatSize(n);n>=0&&(void 0!==t&&void 0!==o&&(r=this._formatProgress(t,o)),this._templating.updateSize(e,r))},_formatProgress:function(e,t){function o(e,t){n=n.replace(e,t)}var n=this._options.text.formatProgress;return o("{percent}",Math.round(e/t*100)),o("{total_size}",this._formatSize(t)),n},_controlFailureTextDisplay:function(e,t){var o,n,r,i,a;o=this._options.failedUploadTextDisplay.mode,n=this._options.failedUploadTextDisplay.maxChars,r=this._options.failedUploadTextDisplay.responseProperty,"custom"===o?(i=t[r],i?i.length>n&&(a=i.substring(0,n)+"..."):i=this._options.text.failUpload,this._templating.setStatusText(e,a||i),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,i)):"default"===o?this._templating.setStatusText(e,this._options.text.failUpload):"none"!==o&&this.log("failedUploadTextDisplay.mode value of '"+o+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qqdropbox.supportedFeatures.ajaxUploading)&&this._templating.showCancel(e)},_itemError:function(){var e=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(e)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,o=e._options.paste.defaultName;return e._options.showPrompt(t,o)}},_fileOrBlobRejected:function(){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e];this._templating.updateThumbnail(e,t)},_addCannedFile:function(){var e=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(e,this.getName(e),!0),this._templating.hideSpinner(e),this._templating.hideCancel(e),this._markFileAsSuccessful(e),e},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))}}}(),qqdropbox.FineUploader=function(e,t){"use strict";this._parent=t?qq[t].FineUploaderBasic:qqdropbox.FineUploaderBasic,this._parent.apply(this,arguments),qqdropbox.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null}},scaling:{hideScaled:!1},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return window.confirm(e)},showPrompt:function(e,t){return window.prompt(e,t)}},!0),qqdropbox.extend(this._options,e,!0),this._templating=new qqdropbox.Templating({log:qqdropbox.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),!qqdropbox.supportedFeatures.uploading||this._options.cors.expected&&!qqdropbox.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._setupClickAndEditEventHandlers(),qqdropbox.DragAndDrop&&qqdropbox.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qqdropbox.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qqdropbox.extend(qqdropbox.FineUploader.prototype,qqdropbox.basePublicApi),qqdropbox.extend(qqdropbox.FineUploader.prototype,qqdropbox.basePrivateApi),qqdropbox.extend(qqdropbox.FineUploader.prototype,qqdropbox.uiPublicApi),qqdropbox.extend(qqdropbox.FineUploader.prototype,qqdropbox.uiPrivateApi),qqdropbox.Templating=function(e){"use strict";function t(){var e,t,o,n,r,i,a,s,d;if(C("Parsing template"),null==z.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qqdropbox.isString(z.templateIdOrEl)){if(e=document.getElementById(z.templateIdOrEl),null===e)throw new Error(qqdropbox.format("Cannot find template script at ID '{}'!",z.templateIdOrEl));t=e.innerHTML}else{if(void 0===z.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");t=z.templateIdOrEl.innerHTML}if(t=qqdropbox.trimStr(t),n=document.createElement("div"),n.appendChild(qqdropbox.toElement(t)),z.button&&(i=qqdropbox(n).getByClass(M.button)[0],i&&qqdropbox(i).remove()),qqdropbox.DragAndDrop&&qqdropbox.supportedFeatures.fileDrop||(d=qqdropbox(n).getByClass(M.dropProcessing)[0],d&&qqdropbox(d).remove()),a=qqdropbox(n).getByClass(M.drop)[0],a&&!qqdropbox.DragAndDrop&&(C("DnD module unavailable.","info"),qqdropbox(a).remove()),a&&!qqdropbox.supportedFeatures.fileDrop&&qqdropbox(a).hasAttribute(L)&&qqdropbox(a).css({display:"none"}),s=qqdropbox(n).getByClass(M.thumbnail)[0],T?s&&(H=parseInt(s.getAttribute(B)),H=H>0?H:null,k=qqdropbox(s).hasAttribute(N)):s&&qqdropbox(s).remove(),T=T&&s,E=qqdropbox(n).getByClass(M.editFilenameInput).length>0,I=qqdropbox(n).getByClass(M.retry).length>0,o=qqdropbox(n).getByClass(M.list)[0],null==o)throw new Error("Could not find the file list container in the template!");return r=o.innerHTML,o.innerHTML="",C("Template parsing complete"),{template:qqdropbox.trimStr(n.innerHTML),fileTemplate:qqdropbox.trimStr(r)}}function o(e){return qqdropbox(U).getByClass(R+e)[0]}function n(e,t){return e&&qqdropbox(e).getByClass(t)[0]}function r(e,t){var o=U,n=o.firstChild;t>0&&(n=qqdropbox(o).children()[t].nextSibling),o.insertBefore(e,n)}function i(e){return n(o(e),M.cancel)}function a(e){return n(o(e),M.pause)}function s(e){return n(o(e),M.continueButton)}function d(e){return null==e?n(D,M.totalProgressBarContainer)||n(D,M.totalProgressBar):n(o(e),M.progressBarContainer)||n(o(e),M.progressBar)}function u(e){return n(o(e),M.spinner)}function l(e){return n(o(e),M.editNameIcon)}function p(e){return n(o(e),M.size)}function c(e){return n(o(e),M.deleteButton)}function h(e){return n(o(e),M.retry)}function f(e){return n(o(e),M.file)}function q(){return n(D,M.dropProcessing)}function m(e){return T&&n(o(e),M.thumbnail)}function b(e){e&&qqdropbox(e).addClass(z.classes.hide)}function g(e){e&&qqdropbox(e).removeClass(z.classes.hide)}function x(e,t){var o=d(e),n=null==e?M.totalProgressBar:M.progressBar;o&&!qqdropbox(o).hasClass(n)&&(o=qqdropbox(o).getByClass(n)[0]),o&&qqdropbox(o).css({width:t+"%"})}function _(){var e=z.placeholders.thumbnailNotAvailable,t=z.placeholders.waitingForThumbnail,o={maxSize:H,scale:k};T&&(e?z.imageGenerator.generate(e,new Image,o).then(function(e){G.success(e)},function(){G.failure(),C("Problem loading 'not available' placeholder image at "+e,"error")}):G.failure(),t?z.imageGenerator.generate(t,new Image,o).then(function(e){X.success(e)},function(){X.failure(),C("Problem loading 'waiting for thumbnail' placeholder image at "+t,"error")}):X.failure())}function v(e){var t=new qqdropbox.Promise;return X.then(function(o){S(o,e),e.src?t.success():(e.src=o.src,e.onload=function(){g(e),t.success()})},function(){b(e),t.success()}),t}function y(e,t){var o=j[e]||(new qqdropbox.Promise).failure(),n=new qqdropbox.Promise;return G.then(function(e){o.then(function(){n.success()},function(){S(e,t),t.onload=function(){n.success()},t.src=e.src,g(t)})}),n}function S(e,t){var o=e.style.maxWidth,n=e.style.maxHeight;n&&o&&!t.style.maxWidth&&!t.style.maxHeight&&qqdropbox(t).css({maxWidth:o,maxHeight:n})}function F(e,t){var o=m(e),n=m(t);C(qqdropbox.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,t,t)),j[t].then(function(){j[e].success(),C(qqdropbox.format("Now using previously generated thumbnail created for ID {} on ID {}.",t,e)),o.src=n.src,g(o)},function(){j[e].failure(),z.placeholders.waitUntilUpdate||y(e,o)})}function w(e,t,o){var n=m(e);return C("Generating new thumbnail for "+e),t.qqThumbnailId=e,z.imageGenerator.generate(t,n,o).then(function(){g(n),j[e].success()},function(){j[e].failure(),z.placeholders.waitUntilUpdate||y(e,n)})}var C,E,I,P,D,U,T,k,A="qq-file-id",R="qq-file-id-",B="qq-max-size",N="qq-server-scale",L="qq-hide-dropzone",O=!1,H=-1,z={log:null,templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},M={button:"qq-upload-button-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},j={},G=new qqdropbox.Promise,X=new qqdropbox.Promise;qqdropbox.extend(z,e),C=z.log,D=z.containerEl,T=void 0!==z.imageGenerator,P=t(),_(),qqdropbox.extend(this,{render:function(){C("Rendering template in DOM."),D.innerHTML=P.template,b(q()),this.hideTotalProgress(),U=z.fileContainerEl||n(D,M.list),C("Template rendering complete")},renderFailure:function(e){var t=qqdropbox.toElement(e);D.innerHTML="",D.appendChild(t)},reset:function(){this.render()},clearFiles:function(){U.innerHTML=""},disableCancel:function(){O=!0},addFile:function(e,t,o){var i=qqdropbox.toElement(P.fileTemplate),u=n(i,M.file);qqdropbox(i).addClass(R+e),u&&qqdropbox(u).setText(t),i.setAttribute(A,e),o?r(i,o.index):U.appendChild(i),b(d(e)),b(p(e)),b(c(e)),b(h(e)),b(a(e)),b(s(e)),O&&this.hideCancel(e)},removeFile:function(e){qqdropbox(o(e)).remove()},getFileId:function(e){var t=e;if(t){for(;null==t.getAttribute(A);)t=t.parentNode;return parseInt(t.getAttribute(A))}},getFileList:function(){return U},markFilenameEditable:function(e){var t=f(e);t&&qqdropbox(t).addClass(z.classes.editable)},updateFilename:function(e,t){var o=f(e);o&&qqdropbox(o).setText(t)},hideFilename:function(e){b(f(e))},showFilename:function(e){g(f(e))},isFileName:function(e){return qqdropbox(e).hasClass(M.file)},getButton:function(){return z.button||n(D,M.button)},hideDropProcessing:function(){b(q())},showDropProcessing:function(){g(q())},getDropZone:function(){return n(D,M.drop)},isEditFilenamePossible:function(){return E},hideRetry:function(e){b(h(e))},isRetryPossible:function(){return I},showRetry:function(e){g(h(e))},getFileContainer:function(e){return o(e)},showEditIcon:function(e){var t=l(e);t&&qqdropbox(t).addClass(z.classes.editable)},hideEditIcon:function(e){var t=l(e);t&&qqdropbox(t).removeClass(z.classes.editable)},isEditIcon:function(e){return qqdropbox(e).hasClass(M.editNameIcon)},getEditInput:function(e){return n(o(e),M.editFilenameInput)},isEditInput:function(e){return qqdropbox(e).hasClass(M.editFilenameInput)},updateProgress:function(e,t,o){var n,r=d(e);r&&(n=Math.round(t/o*100),100===n?b(r):g(r),x(e,n))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=d(e);t&&b(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){x(e,0)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!O){var t=i(e);t&&qqdropbox(t).removeClass(z.classes.hide)}},hideCancel:function(e){b(i(e))},isCancel:function(e){return qqdropbox(e).hasClass(M.cancel)},allowPause:function(e){g(a(e)),b(s(e))},uploadPaused:function(e){this.setStatusText(e,z.text.paused),this.allowContinueButton(e),b(u(e))},hidePause:function(e){b(a(e))},isPause:function(e){return qqdropbox(e).hasClass(M.pause)},isContinueButton:function(e){return qqdropbox(e).hasClass(M.continueButton)},allowContinueButton:function(e){g(s(e)),b(a(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),g(u(e))},showDeleteButton:function(e){g(c(e))},hideDeleteButton:function(e){b(c(e))},isDeleteButton:function(e){return qqdropbox(e).hasClass(M.deleteButton)},isRetry:function(e){return qqdropbox(e).hasClass(M.retry)},updateSize:function(e,t){var o=p(e);o&&(g(o),qqdropbox(o).setText(t))},setStatusText:function(e,t){var r=n(o(e),M.statusText);r&&(null==t?qqdropbox(r).clearText():qqdropbox(r).setText(t))},hideSpinner:function(e){b(u(e))},showSpinner:function(e){g(u(e))},generatePreview:function(e,t){var o=t&&t.qqThumbnailId,n=m(e),r={maxSize:H,scale:!0,orient:!0};qqdropbox.supportedFeatures.imagePreviews?n&&v(n).done(function(){j[e]=new qqdropbox.Promise,null!=o?F(e,o):w(e,t,r)
}):n&&v(n)},updateThumbnail:function(e,t,o){var n=m(e),r={maxSize:H,scale:k};if(n){if(t)return o&&v(n),z.imageGenerator.generate(t,n,r).then(function(){g(n)},function(){y(e,n)});y(e,n)}}})},qqdropbox.traditional=qqdropbox.traditional||{},qqdropbox.traditional.FormUploadHandler=function(e,t){"use strict";function o(e){var t={};try{t=qqdropbox.parseJson(e)}catch(o){d("Error when attempting to parse iframe upload response ("+o.message+")","error")}return t}function n(e,t){var n;try{var r=t.contentDocument||t.contentWindow.document,i=r.body.innerHTML;d("converting iframe's innerHTML to JSON"),d("innerHTML = "+i),i&&i.match(/^<pre/i)&&(i=r.body.firstChild.firstChild.nodeValue),n=o(i)}catch(a){d("Error when attempting to parse form upload response ("+a.message+")","error"),n={success:!1}}return n}function r(t,o){var n=e.paramsStore.get(t),r=e.demoMode?"GET":"PUT",d=e.endpointStore.get(t),u=a(t);return n[e.uuidName]=s(t),n[e.filenameParam]=u,i._initFormForUpload({method:r,endpoint:d,params:n,paramsInBody:e.paramsInBody,targetName:o.name})}var i=this,a=t.getName,s=t.getUuid,d=t.log;this.uploadFile=function(t){var o,a=i.getInput(t),s=i._createIframe(t),u=new qqdropbox.Promise;return o=r(t,s),o.appendChild(a),i._attachLoadEvent(s,function(o){d("iframe loaded");var r=o?o:n(t,s);i._detachLoadEvent(t),e.cors.expected||qqdropbox(s).remove(),r.success?u.success(r):u.failure(r)}),d("Sending upload request for "+t),o.submit(),qqdropbox(o).remove(),u},qqdropbox.extend(this,new qqdropbox.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:a,getUuid:s,log:d}}))},qqdropbox.traditional=qqdropbox.traditional||{},qqdropbox.traditional.XhrUploadHandler=function(e,t){"use strict";var o=this,n=t.getName,r=t.getSize,i=t.getUuid,a=t.log,s=e.forceMultipart||e.paramsInBody,d=function(t,o,i){var a=r(t),d=n(t);o[e.chunking.paramNames.partIndex]=i.part,o[e.chunking.paramNames.partByteOffset]=i.start,o[e.chunking.paramNames.chunkSize]=i.size,o[e.chunking.paramNames.totalParts]=i.count,o[e.totalFileSizeName]=a,s&&(o[e.filenameParam]=d)},u=new qqdropbox.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,log:a}),l=function(e,t){var o=new qqdropbox.Promise;return t.onreadystatechange=function(){if(4===t.readyState){var n=h(e,t);n.success?o.success(n.response,t):o.failure(n.response,t)}},o},p=function(t){var a=e.paramsStore.get(t),s=n(t),d=r(t);return a[e.uuidName]=i(t),a[e.filenameParam]=s,a[e.totalFileSizeName]=d,a[e.chunking.paramNames.totalParts]=o._getTotalChunks(t),a},c=function(e){return 200!==e.status},h=function(e,t){var o;return a("xhr - server response received for "+e),a("responseText = "+t.responseText),o=f(!0,t),{success:!c(t,o),response:o}},f=function(e,t){var o={};try{a(qqdropbox.format("Received response status {} with body: {}",t.status,t.responseText)),o=qqdropbox.parseJson(t.responseText)}catch(n){e&&a("Error when attempting to parse xhr response text ("+n.message+")","error")}return o},q=function(t){var n=new qqdropbox.Promise;return u.complete(t,o._createXhr(t),p(t),e.customHeaders.get(t)).then(function(e){n.success(f(!1,e),e)},function(e){n.failure(f(!1,e),e)}),n},m=function(e,t){""!=e?t.open("PUT","https://api-content.dropbox.com/1/chunked_upload?upload_id="+JSON.parse(e.responseText).upload_id+"&offset="+JSON.parse(e.responseText).offset,!0):t.open("PUT","https://api-content.dropbox.com/1/chunked_upload",!0)},b=function(t,n){var r=e.customHeaders.get(t),i=o.getFile(t);n.setRequestHeader("Accept","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Cache-Control","no-cache"),s||(n.setRequestHeader("Content-Type","application/octet-stream"),n.setRequestHeader("X-Mime-Type",i.type)),qqdropbox.each(r,function(e,t){n.setRequestHeader(e,t)})};qqdropbox.extend(this,{uploadChunk:function(t,n,i,a){{var s,u,p=o._getChunkData(t,n),c=o._createXhr(t,n);r(t)}return s=l(t,c),o._registerProgressHandler(t,n,p.size),u=e.paramsStore.get(t),d(t,u,p),i&&(u[e.resume.paramNames.resuming]=!0),m(a,c),b(t,c),c.send(p.blob),s},uploadFile:function(t){var n,r,i,a=o.getFile(t);return r=o._createXhr(t),o._registerProgressHandler(t),n=l(t,r),i=e.paramsStore.get(t),m("",r),b(t,r),r.send(a),n}}),qqdropbox.extend(this,new qqdropbox.XhrUploadHandler({options:qqdropbox.extend({namespace:"traditional"},e),proxy:qqdropbox.extend({getEndpoint:e.endpointStore.get},t)})),qqdropbox.override(this,function(t){return{finalizeChunks:function(o){return e.chunking.success.endpoint?q(o):t.finalizeChunks(o,qqdropbox.bind(f,this,!0))}}})},qqdropbox.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,o="PUT",n={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(){}},r={},i={get:function(){return n.endpoint}};qqdropbox.extend(n,e),t=qqdropbox.extend(this,new qqdropbox.AjaxRequester({acceptHeader:"application/json",validMethods:[o],method:o,successfulResponseCodes:function(){var e={};return e[o]=[200,201,202],e}(),endpointStore:i,allowXRequestedWithAndCacheControl:!1,cors:n.cors,log:n.log,onComplete:function(e,t,o){var n=r[e];delete r[e],o?n.failure(t):n.success(t)}})),qqdropbox.extend(this,{complete:function(e,o,i,a){var s=new qqdropbox.Promise;return n.log("Submitting All Chunks Done request for "+e),r[e]=s,t.initTransport(e).withParams(i).withHeaders(a).send(o),s}})},qqdropbox.PasteSupport=function(e){"use strict";function t(e){return e.type&&0===e.type.indexOf("image/")}function o(){qqdropbox(r.targetElement).attach("paste",function(e){var o=e.clipboardData;o&&qqdropbox.each(o.items,function(e,o){if(t(o)){var n=o.getAsFile();r.callbacks.pasteReceived(n)}})})}function n(){i&&i()}var r,i;r={targetElement:null,callbacks:{log:function(){},pasteReceived:function(){}}},qqdropbox.extend(r,e),o(),qqdropbox.extend(this,{reset:function(){n()}})},qqdropbox.DragAndDrop=function(e){"use strict";function t(e,t){var o=Array.prototype.slice.call(e);u.callbacks.dropLog("Grabbed "+e.length+" dropped files."),t.dropDisabled(!1),u.callbacks.processingDroppedFilesComplete(o,t.getElement())}function o(e){var t=new qqdropbox.Promise;return e.isFile?e.file(function(o){var n=e.name,r=e.fullPath,i=r.indexOf(n);r=r.substr(0,i),"/"===r.charAt(0)&&(r=r.substr(1)),o.qqPath=r,h.push(o),t.success()},function(o){u.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+o.code+".","error"),t.failure()}):e.isDirectory&&n(e).then(function(e){var n=e.length;qqdropbox.each(e,function(e,r){o(r).done(function(){n-=1,0===n&&t.success()})}),e.length||t.success()},function(o){u.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+o.code+".","error"),t.failure()}),t}function n(e,t,o,r){var i=r||new qqdropbox.Promise,a=t||e.createReader();return a.readEntries(function(t){var r=o?o.concat(t):t;t.length?setTimeout(function(){n(e,a,r,i)},0):i.success(r)},i.failure),i}function r(e,t){var n=[],r=new qqdropbox.Promise;return u.callbacks.processingDroppedFiles(),t.dropDisabled(!0),e.files.length>1&&!u.allowMultipleItems?(u.callbacks.processingDroppedFilesComplete([]),u.callbacks.dropError("tooManyFilesError",""),t.dropDisabled(!1),r.failure()):(h=[],qqdropbox.isFolderDropSupported(e)?qqdropbox.each(e.items,function(e,t){var i=t.webkitGetAsEntry();i&&(i.isFile?h.push(t.getAsFile()):n.push(o(i).done(function(){n.pop(),0===n.length&&r.success()})))}):h=e.files,0===n.length&&r.success()),r}function i(e){var o=new qqdropbox.UploadDropZone({HIDE_ZONES_EVENT_NAME:l,element:e,onEnter:function(t){qqdropbox(e).addClass(u.classes.dropActive),t.stopPropagation()},onLeaveNotDescendants:function(){qqdropbox(e).removeClass(u.classes.dropActive)},onDrop:function(e){r(e.dataTransfer,o).then(function(){t(h,o)},function(){u.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return f.addDisposer(function(){o.dispose()}),qqdropbox(e).hasAttribute(p)&&qqdropbox(e).hide(),c.push(o),o}function a(e){var t;return qqdropbox.each(e.dataTransfer.types,function(e,o){return"Files"===o?(t=!0,!1):void 0}),t}function s(e){return qqdropbox.firefox()?!e.relatedTarget:qqdropbox.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function d(){var e=u.dropZoneElements,t=function(){setTimeout(function(){qqdropbox.each(e,function(e,t){qqdropbox(t).hasAttribute(p)&&qqdropbox(t).hide(),qqdropbox(t).removeClass(u.classes.dropActive)})},10)};qqdropbox.each(e,function(t,o){var n=i(o);!e.length||qqdropbox.ie()&&!qqdropbox.ie10()||f.attach(document,"dragenter",function(t){!n.dropDisabled()&&a(t)&&qqdropbox.each(e,function(e,t){t instanceof HTMLElement&&qqdropbox(t).css({display:"block"})})})}),f.attach(document,"dragleave",function(e){s(e)&&t()}),f.attach(qqdropbox(document).children()[0],"mouseenter",function(){t()}),f.attach(document,"drop",function(e){e.preventDefault(),t()}),f.attach(document,l,t)}var u,l="qq-hidezones",p="qq-hide-dropzone",c=[],h=[],f=new qqdropbox.DisposeSupport;u={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qqdropbox.DragAndDrop.callbacks},qqdropbox.extend(u,e,!0),d(),qqdropbox.extend(this,{setupExtraDropzone:function(e){u.dropZoneElements.push(e),i(e)},removeDropzone:function(e){var t,o=u.dropZoneElements;for(t in o)if(o[t]===e)return o.splice(t,1)},dispose:function(){f.dispose(),qqdropbox.each(c,function(e,t){t.dispose()})}})},qqdropbox.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(){},dropError:function(e,t){qqdropbox.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qqdropbox.log(e,t)}}},qqdropbox.UploadDropZone=function(e){"use strict";function t(){return qqdropbox.safari()||qqdropbox.firefox()&&qqdropbox.windows()}function o(){l||(t?p.attach(document,"dragover",function(e){e.preventDefault()}):p.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),l=!0)}function n(e){if(qqdropbox.ie()&&!qqdropbox.ie10())return!1;var t,o=e.dataTransfer,n=qqdropbox.safari();return t=qqdropbox.ie10()||qqdropbox.ie11()?!0:"none"!==o.effectAllowed,o&&t&&(o.files||!n&&o.types.contains&&o.types.contains("Files"))}function r(e){return void 0!==e&&(u=e),u}function i(){function e(){t=document.createEvent("Event"),t.initEvent(s.HIDE_ZONES_EVENT_NAME,!0,!0)}var t;if(window.CustomEvent)try{t=new CustomEvent(s.HIDE_ZONES_EVENT_NAME)}catch(o){e()}else e();document.dispatchEvent(t)}function a(){p.attach(d,"dragover",function(e){if(n(e)){var t=qqdropbox.ie()||qqdropbox.ie11()?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",e.stopPropagation(),e.preventDefault()}}),p.attach(d,"dragenter",function(e){if(!r()){if(!n(e))return;s.onEnter(e)}}),p.attach(d,"dragleave",function(e){if(n(e)){s.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);qqdropbox(this).contains(t)||s.onLeaveNotDescendants(e)}}),p.attach(d,"drop",function(e){if(!r()){if(!n(e))return;e.preventDefault(),e.stopPropagation(),s.onDrop(e),i()}})}var s,d,u,l,p=new qqdropbox.DisposeSupport;s={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qqdropbox.extend(s,e),d=s.element,o(),a(),qqdropbox.extend(this,{dropDisabled:function(e){return r(e)},dispose:function(){p.dispose()},getElement:function(){return d}})},qqdropbox.DeleteFileAjaxRequester=function(e){"use strict";function t(){return"PUT"===n.method.toUpperCase()?{_method:"DELETE"}:{}}var o,n={method:"z",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(){return{}},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(){},onDelete:function(){},onDeleteComplete:function(){}};qqdropbox.extend(n,e),o=qqdropbox.extend(this,new qqdropbox.AjaxRequester({acceptHeader:"application/json",validMethods:["PUT","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:t(),maxConnections:n.maxConnections,customHeaders:function(e){return n.customHeaders.get(e)},demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qqdropbox.extend(this,{sendDelete:function(e,t,r){var i=r||{};n.log("Submitting delete file request for "+e),"DELETE"===n.method?o.initTransport(e).withPath(t).withParams(i).send():(i[n.uuidParamName]=t,o.initTransport(e).withParams(i).send())}})},function(){function e(e){var t=e.naturalWidth,o=e.naturalHeight;if(t*o>1048576){var n=document.createElement("canvas");n.width=n.height=1;var r=n.getContext("2d");return r.drawImage(e,-t+1,0),0===r.getImageData(0,0,1,1).data[3]}return!1}function t(e,t,o){var n=document.createElement("canvas");n.width=1,n.height=o;var r=n.getContext("2d");r.drawImage(e,0,0);for(var i=r.getImageData(0,0,1,o).data,a=0,s=o,d=o;d>a;){var u=i[4*(d-1)+3];0===u?s=d:a=d,d=s+a>>1}var l=d/o;return 0===l?1:l}function o(e,t,o){var r=document.createElement("canvas"),i=t.mime||"image/jpeg";return n(e,r,t,o),r.toDataURL(i,t.quality||.8)}function n(o,n,i,a){var s=o.naturalWidth,d=o.naturalHeight,u=i.width,l=i.height,p=n.getContext("2d");if(p.save(),r(n,u,l,i.orientation),qqdropbox.ios()){var c=e(o);c&&(s/=2,d/=2);var h=1024,f=document.createElement("canvas");f.width=f.height=h;for(var q=f.getContext("2d"),m=a?t(o,s,d):1,b=Math.ceil(h*u/s),g=Math.ceil(h*l/d/m),x=0,_=0;d>x;){for(var v=0,y=0;s>v;)q.clearRect(0,0,h,h),q.drawImage(o,-v,-x),p.drawImage(f,0,0,h,h,y,_,b,g),v+=h,y+=b;x+=h,_+=g}p.restore(),f=q=null}else p.drawImage(o,0,0,u,l);n.qqImageRendered&&n.qqImageRendered()}function r(e,t,o,n){switch(n){case 5:case 6:case 7:case 8:e.width=o,e.height=t;break;default:e.width=t,e.height=o}var r=e.getContext("2d");switch(n){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,o),r.rotate(Math.PI);break;case 4:r.translate(0,o),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-o);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-o),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}}function i(e,t){if(window.Blob&&e instanceof Blob){var o=new Image,n=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!n)throw Error("No createObjectURL function found to create blob url");o.src=n.createObjectURL(e),this.blob=e,e=o}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=function(){var e=r.imageLoadListeners;e&&(r.imageLoadListeners=null,setTimeout(function(){for(var t=0,o=e.length;o>t;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]}this.srcImage=e}i.prototype.render=function(e,t){if(this.imageLoadListeners){var r=this;return void this.imageLoadListeners.push(function(){r.render(e,t)})}t=t||{};var i=this.srcImage.naturalWidth,a=this.srcImage.naturalHeight,s=t.width,d=t.height,u=t.maxWidth,l=t.maxHeight,p=!this.blob||"image/jpeg"===this.blob.type;s&&!d?d=a*s/i<<0:d&&!s?s=i*d/a<<0:(s=i,d=a),u&&s>u&&(s=u,d=a*s/i<<0),l&&d>l&&(d=l,s=i*d/a<<0);var c={width:s,height:d};for(var h in t)c[h]=t[h];var f=e.tagName.toLowerCase();"img"===f?e.src=o(this.srcImage,c,p):"canvas"===f&&n(this.srcImage,e,c,p),"function"==typeof this.onrender&&this.onrender(e)},"function"==typeof define&&define.amd?define([],function(){return i}):this.MegaPixImage=i}(),qqdropbox.ImageGenerator=function(e){"use strict";function t(e){return"img"===e.tagName.toLowerCase()}function o(e){return"canvas"===e.tagName.toLowerCase()}function n(){return void 0!==(new Image).crossOrigin}function r(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function i(e){var t=e.split("/"),o=t[t.length-1],n=qqdropbox.getExtension(o);switch(n=n&&n.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function a(e){var t,o,n,r=document.createElement("a");return r.href=e,t=r.protocol,n=r.port,o=r.hostname,t.toLowerCase()!==window.location.protocol.toLowerCase()?!0:o.toLowerCase()!==window.location.hostname.toLowerCase()?!0:n===window.location.port||qqdropbox.ie()?!1:!0}function s(t,o){t.onload=function(){t.onload=null,t.onerror=null,o.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),o.failure(t,"Problem drawing thumbnail!")}}function d(e,t){e.qqImageRendered=function(){t.success(e)}}function u(n,r){var i=t(n)||o(n);return t(n)?s(n,r):o(n)?d(n,r):(r.failure(n),e(qqdropbox.format("Element container of type {} is not supported!",n.tagName),"error")),i}function l(t,o,n){var r=new qqdropbox.Promise,i=new qqdropbox.Identify(t,e),a=n.maxSize,s=null==n.orient?!0:n.orient,d=function(){o.onerror=null,o.onload=null,e("Could not render preview, file may be too large!","error"),r.failure(o,"Browser cannot render image!")};return i.isPreviewable().then(function(n){var i={parse:function(){return(new qqdropbox.Promise).success()}},l=s?new qqdropbox.Exif(t,e):i,p=new MegaPixImage(t,d);u(o,r)&&l.parse().then(function(e){var t=e&&e.Orientation;p.render(o,{maxWidth:a,maxHeight:a,orientation:t,mime:n})},function(t){e(qqdropbox.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),p.render(o,{maxWidth:a,maxHeight:a,mime:n})})},function(){e("Not previewable"),r.failure(o,"Not previewable")}),r}function p(e,t,o,n){var r=new Image,s=new qqdropbox.Promise;u(r,s),a(e)&&(r.crossOrigin="anonymous"),r.src=e,s.then(function(){u(t,o);var a=new MegaPixImage(r);a.render(t,{maxWidth:n,maxHeight:n,mime:i(e)})})}function c(e,t,o,n){u(t,o),qqdropbox(t).css({maxWidth:n+"px",maxHeight:n+"px"}),t.src=e}function h(e,i,s){var d=new qqdropbox.Promise,l=s.scale,h=l?s.maxSize:null;return l&&t(i)?r()?a(e)&&!n()?c(e,i,d,h):p(e,i,d,h):c(e,i,d,h):o(i)?p(e,i,d,h):u(i,d)&&(i.src=e),d}qqdropbox.extend(this,{generate:function(t,o,n){return qqdropbox.isString(t)?(e("Attempting to update thumbnail based on server response."),h(t,o,n||{})):(e("Attempting to draw client-side image preview."),l(t,o,n||{}))}}),this._testing={},this._testing.isImg=t,this._testing.isCanvas=o,this._testing.isCrossOrigin=a,this._testing.determineMimeOfFileName=i},qqdropbox.Exif=function(e,t){"use strict";function o(e){for(var t=0,o=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,o),e=e.substring(2,e.length),o+=8;return t}function n(t,o){var r=t,i=o;return void 0===r&&(r=2,i=new qqdropbox.Promise),qqdropbox.readBlobToHex(e,r,4).then(function(e){var t=/^ffe([0-9])/.exec(e);if(t)if("1"!==t[1]){var o=parseInt(e.slice(4,8),16);n(r+o+2,i)}else i.success(r);else i.failure("No EXIF header to be found!")}),i}function r(){var t=new qqdropbox.Promise;return qqdropbox.readBlobToHex(e,0,6).then(function(e){0!==e.indexOf("ffd8")?t.failure("Not a valid JPEG!"):n().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}function i(t){var o=new qqdropbox.Promise;return qqdropbox.readBlobToHex(e,t+10,2).then(function(e){o.success("4949"===e)}),o}function a(t,n){var r=new qqdropbox.Promise;return qqdropbox.readBlobToHex(e,t+18,2).then(function(e){return n?r.success(o(e)):void r.success(parseInt(e,16))}),r}function s(t,o){var n=t+20,r=12*o;return qqdropbox.readBlobToHex(e,n,r)}function d(e){for(var t=[],o=0;o+24<=e.length;)t.push(e.slice(o,o+24)),o+=24;return t}function u(e,t){var n=16,r=qqdropbox.extend([],l),i={};return qqdropbox.each(t,function(t,a){var s,d,u,l=a.slice(0,4),c=e?o(l):parseInt(l,16),h=r.indexOf(c);return h>=0&&(d=p[c].name,u=p[c].bytes,s=a.slice(n,n+2*u),i[d]=e?o(s):parseInt(s,16),r.splice(h,1)),0===r.length?!1:void 0}),i}var l=[274],p={274:{name:"Orientation",bytes:2}};qqdropbox.extend(this,{parse:function(){var o=new qqdropbox.Promise,n=function(e){t(qqdropbox.format("EXIF header parse failed: '{}' ",e)),o.failure(e)};return r().then(function(r){t(qqdropbox.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),i(r).then(function(e){t(qqdropbox.format("EXIF Byte order is {} endian",e?"little":"big")),a(r,e).then(function(i){t(qqdropbox.format("Found {} APP1 directory entries",i)),s(r,i).then(function(n){var r=d(n),i=u(e,r);t("Successfully parsed some EXIF tags"),o.success(i)},n)},n)},n)},n),o}}),this._testing={},this._testing.parseLittleEndian=o},qqdropbox.Identify=function(e,t){"use strict";function o(e,t){var o=!1,n=[].concat(e);return qqdropbox.each(n,function(e,n){return 0===t.indexOf(n)?(o=!0,!1):void 0}),o}qqdropbox.extend(this,{isPreviewable:function(){var n=this,r=new qqdropbox.Promise,i=!1,a=void 0===e.name?"blob":e.name;return t(qqdropbox.format("Attempting to determine if {} can be rendered in this browser",a)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qqdropbox.readBlobToHex(e,0,4).then(function(e){qqdropbox.each(n.PREVIEWABLE_MIME_TYPES,function(t,n){return o(n,e)?(("image/tiff"!==t||qqdropbox.supportedFeatures.tiffPreviews)&&(i=!0,r.success(t)),!1):void 0}),t(qqdropbox.format("'{}' is {} able to be rendered in this browser",a,i?"":"NOT")),i||r.failure()},function(){t("Error reading file w/ name '"+e.name+"'.  Not able to be rendered in this browser."),r.failure()})):r.failure(),r},isPreviewableSync:function(){var o=e.type,n=qqdropbox.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),o)>=0,r=!1;return n&&(r="image/tiff"===o?qqdropbox.supportedFeatures.tiffPreviews:!0),!r&&t(e.name+" is not previewable in this browser per the blob's type attr"),r}})},qqdropbox.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qqdropbox.ImageValidation=function(e,t){"use strict";function o(e){var t=!1;return qqdropbox.each(e,function(e,o){return o>0?(t=!0,!1):void 0}),t}function n(){var o=new qqdropbox.Promise;return new qqdropbox.Identify(e,t).isPreviewable().then(function(){var n=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;r?(n.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),o.failure()},n.onload=function(){o.success({width:this.width,height:this.height})},n.src=r.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),o.failure())},o.failure),o}function r(e,t){var o;return qqdropbox.each(e,function(e,n){if(n>0){var r=/(max|min)(Width|Height)/.exec(e),i=r[2].charAt(0).toLowerCase()+r[2].slice(1),a=t[i];switch(r[1]){case"min":if(n>a)return o=e,!1;break;case"max":if(a>n)return o=e,!1}}}),o}this.validate=function(e){var i=new qqdropbox.Promise;return t("Attempting to validate image."),o(e)?n().then(function(t){var o=r(e,t);o?i.failure(o):i.success()},i.success):i.success(),i}},qqdropbox.Session=function(e){"use strict";function t(e){return qqdropbox.isArray(e)?!0:void n.log("Session response is not an array.","error")}function o(e,o,r,i){var a=!1;o=o&&t(e),o&&qqdropbox.each(e,function(e,t){if(null==t.uuid)a=!0,n.log(qqdropbox.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==t.name)a=!0,n.log(qqdropbox.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return n.addFileRecord(t),!0}catch(o){a=!0,n.log(o.message,"error")}return!1}),i[o&&!a?"success":"failure"](e,r)}var n={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(){},log:function(){}};qqdropbox.extend(n,e,!0),this.refresh=function(){var e=new qqdropbox.Promise,t=function(t,n,r){o(t,n,r,e)},r=qqdropbox.extend({},n),i=new qqdropbox.SessionAjaxRequester(qqdropbox.extend(r,{onComplete:t}));return i.queryServer(),e}},qqdropbox.SessionAjaxRequester=function(e){"use strict";function t(e,t,o){var r=null;if(null!=t.responseText)try{r=qqdropbox.parseJson(t.responseText)}catch(i){n.log("Problem parsing session response: "+i.message,"error"),o=!0}n.onComplete(r,!o,t)}var o,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(){},log:function(){}};qqdropbox.extend(n,e),o=qqdropbox.extend(this,new qqdropbox.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:t,cors:n.cors})),qqdropbox.extend(this,{queryServer:function(){var e=qqdropbox.extend({},n.params);n.log("Session query request."),o.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qqdropbox.FormSupport=function(e,t,o){"use strict";function n(e){e.getAttribute("action")&&(s.newEndpoint=e.getAttribute("action"))}function r(e,t){return!e.checkValidity||e.checkValidity()?!0:(o("Form did not pass validation checks - will not upload.","error"),void t())}function i(e){var o=e.submit;qqdropbox(e).attach("submit",function(n){n=n||window.event,n.preventDefault?n.preventDefault():n.returnValue=!1,r(e,o)&&t()}),e.submit=function(){r(e,o)&&t()}}function a(e){return e&&(qqdropbox.isString(e)&&(e=document.getElementById(e)),e&&(o("Attaching to form element."),n(e),d&&i(e))),e}var s=this,d=e.interceptSubmit,u=e.element,l=e.autoUpload;qqdropbox.extend(this,{newEndpoint:null,newAutoUpload:l,attachedToForm:!1,getFormInputsAsObject:function(){return null==u?null:s._form2Obj(u)}}),u=a(u),this.attachedToForm=!!u},qqdropbox.extend(qqdropbox.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},o=function(e){var t=["button","image","reset","submit"];return qqdropbox.indexOf(t,e.toLowerCase())<0},n=function(e){return qqdropbox.indexOf(["checkbox","radio"],e.toLowerCase())>=0},r=function(e){return n(e.type)&&!e.checked?!0:e.disabled&&"hidden"!==e.type.toLowerCase()},i=function(e){var t=null;return qqdropbox.each(qqdropbox(e).children(),function(e,o){return"option"===o.tagName.toLowerCase()&&o.selected?(t=o.value,!1):void 0}),t};return qqdropbox.each(e.elements,function(e,n){if(!qqdropbox.isInput(n,!0)&&"textarea"!==n.tagName.toLowerCase()||!o(n.type)||r(n)){if("select"===n.tagName.toLowerCase()&&!r(n)){var a=i(n);null!==a&&(t[n.name]=a)}}else t[n.name]=n.value}),t}}),qqdropbox.Scaler=function(e,t){"use strict";var o=e.sendOriginal,n=e.orient,r=e.defaultType,i=e.defaultQuality/100,a=e.failureText,s=e.includeExif,d=this._getSortedSizes(e.sizes);qqdropbox.extend(this,{enabled:qqdropbox.supportedFeatures.scaling&&d.length>0,getFileRecords:function(e,u,l){var p=this,c=[],h=l.blob?l.blob:l,f=new qqdropbox.Identify(h,t);return f.isPreviewableSync()&&qqdropbox.each(d,function(e,o){var d=p._determineOutputType({defaultType:r,requestedType:o.type,refType:h.type});c.push({uuid:qqdropbox.getUniqueId(),name:p._getName(u,{name:o.name,type:d,refType:h.type}),blob:new qqdropbox.BlobProxy(h,qqdropbox.bind(p._generateScaledImage,p,{maxSize:o.maxSize,orient:n,type:d,quality:i,failedText:a,includeExif:s,log:t}))})}),o&&c.push({uuid:e,name:u,blob:h}),c},handleNewFile:function(e,t,o,n,r,i,a,s){var d=this,u=(e.qqButtonId||e.blob&&e.blob.qqButtonId,[]),l=null,p=s.addFileToHandler,c=s.uploadData,h=s.paramsStore,f=qqdropbox.getUniqueId();qqdropbox.each(d.getFileRecords(o,t,e),function(t,o){var i,s=e,d=n;o.blob instanceof qqdropbox.BlobProxy&&(s=o.blob,d=-1),i=c.addFile({uuid:o.uuid,name:o.name,size:d,batchId:a,proxyGroupId:f}),o.blob instanceof qqdropbox.BlobProxy?u.push(i):l=i,p(i,s),r.push({id:i,file:s})}),null!==l&&(qqdropbox.each(u,function(e,t){var o={qqparentuuid:c.retrieve({id:l}).uuid,qqparentsize:c.retrieve({id:l}).size};o[i]=c.retrieve({id:t}).uuid,c.setParentId(t,l),h.addReadOnly(t,o)}),u.length&&!function(){var e={};e[i]=c.retrieve({id:l}).uuid,h.addReadOnly(l,e)}())}})},qqdropbox.extend(qqdropbox.Scaler.prototype,{scaleImage:function(e,t,o){"use strict";if(!qqdropbox.supportedFeatures.scaling)throw new qqdropbox.Error("Scaling is not supported in this browser!");var n=new qqdropbox.Promise,r=o.log,i=o.getFile(e),a=o.uploadData.retrieve({id:e}),s=a&&a.name,d=a&&a.uuid,u={sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},l=new qqdropbox.Scaler(u,r);return qqdropbox.Scaler&&qqdropbox.supportedFeatures.imagePreviews&&i?qqdropbox.bind(function(){var t;t=l.getFileRecords(d,s,i)[0],t?t.blob.create().then(n.success,n.failure):(r(e+" is not a scalable image!","error"),n.failure())},this)():(n.failure(),r("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),n},_determineOutputType:function(e){"use strict";var t=e.requestedType,o=e.defaultType,n=e.refType;return o||t?t&&qqdropbox.indexOf(Object.keys(qqdropbox.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?"image/tiff"===t?qqdropbox.supportedFeatures.tiffPreviews?t:o:t:o:"image/jpeg"!==n?"image/png":n},_getName:function(e,t){"use strict";var o=e.lastIndexOf("."),n=" ("+t.name+")",r=t.type||"image/png",i=t.refType,a="",s=qqdropbox.getExtension(e);return o>=0?(a=e.substr(0,o),i!==r&&(s=r.split("/")[1]),a+=n+"."+s):a=e+n,a},_getSortedSizes:function(e){"use strict";return e=qqdropbox.extend([],e),e.sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var o=this,n=e.log,r=e.maxSize,i=e.orient,a=e.type,s=e.quality,d=e.failedText,u=e.includeExif&&"image/jpeg"===t.type&&"image/jpeg"===a,l=new qqdropbox.Promise,p=new qqdropbox.ImageGenerator(n),c=document.createElement("canvas");return n("Attempting to generate scaled version for "+t.name),p.generate(t,c,{maxSize:r,orient:i}).then(function(){var e=c.toDataURL(a,s),r=function(){n("Success generating scaled version for "+t.name);var r=o._dataUriToBlob(e);l.success(r)};u?o._insertExifHeader(t,e,n).then(function(t){e=t,r()},function(){n("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),r()}):r()},function(){n("Failed attempt to generate scaled version for "+t.name,"error"),l.failure(d)}),l},_insertExifHeader:function(e,t,o){"use strict";var n=new FileReader,r=new qqdropbox.Promise,i="";return n.onload=function(){i=n.result,r.success(ExifRestorer.restore(i,t))},n.onerror=function(){o("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),r.failure()},n.readAsDataURL(e),r},_dataUriToBlob:function(e){"use strict";var t,o,n,r;return t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),r=new Uint8Array(n),qqdropbox.each(t,function(e,t){r[e]=t.charCodeAt(0)}),this._createBlob(n,o)},_createBlob:function(e,t){"use strict";console.log("Blob _createBlob");var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=o&&new o;return n?(n.append(e),n.getBlob(t)):(console.log("Blob"),new Blob([e],{type:t}))}});var ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(e){var t,o,n,r,i,a="",s="",d="",u=0;do t=e[u++],o=e[u++],s=e[u++],n=t>>2,r=(3&t)<<4|o>>4,i=(15&o)<<2|s>>6,d=63&s,isNaN(o)?i=d=64:isNaN(s)&&(d=64),a=a+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(d),t=o=s="",n=r=i=d="";while(u<e.length);return a},e.restore=function(e,t){var o="data:image/jpeg;base64,";if(!e.match(o))return t;var n=this.decode64(e.replace(o,"")),r=this.slice2Segments(n),i=this.exifManipulation(t,r);return o+this.encode64(i)},e.exifManipulation=function(e,t){var o=this.getExifArray(t),n=this.insertExif(e,o),r=new Uint8Array(n);return r},e.getExifArray=function(e){for(var t,o=0;o<e.length;o++)if(t=e[o],255==t[0]&225==t[1])return t;return[]},e.insertExif=function(e,t){var o=e.replace("data:image/jpeg;base64,",""),n=this.decode64(o),r=n.indexOf(255,3),i=n.slice(0,r),a=n.slice(r),s=i;return s=s.concat(t),s=s.concat(a)
},e.slice2Segments=function(e){for(var t=0,o=[];;){if(255==e[t]&218==e[t+1])break;if(255==e[t]&216==e[t+1])t+=2;else{var n=256*e[t+2]+e[t+3],r=t+n+2,i=e.slice(t,r);o.push(i),t=r}if(t>e.length)break}return o},e.decode64=function(e){var t,o,n,r,i,a="",s="",d=0,u=[],l=/[^A-Za-z0-9\+\/\=]/g;if(l.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.KEY_STR.indexOf(e.charAt(d++)),r=this.KEY_STR.indexOf(e.charAt(d++)),i=this.KEY_STR.indexOf(e.charAt(d++)),s=this.KEY_STR.indexOf(e.charAt(d++)),t=n<<2|r>>4,o=(15&r)<<4|i>>2,a=(3&i)<<6|s,u.push(t),64!=i&&u.push(o),64!=s&&u.push(a),t=o=a="",n=r=i=s="";while(d<e.length);return u},e}();qqdropbox.TotalProgress=function(e,t){"use strict";var o={},n=0,r=0,i=-1,a=-1,s=function(t,o){(t!==i||o!==a)&&e(t,o),i=t,a=o},d=function(e,t){var o=!0;return qqdropbox.each(e,function(e,n){return qqdropbox.indexOf(t,n)>=0?(o=!1,!1):void 0}),o},u=function(e){c(e,-1,-1),delete o[e]},l=function(e,t,o){(0===t.length||d(t,o))&&(s(r,r),this.reset())},p=function(e){var n=t(e);n>0&&(c(e,0,n),o[e]={loaded:0,total:n})},c=function(e,t,i){var a=o[e]?o[e].loaded:0,d=o[e]?o[e].total:0;-1===t&&-1===i?(n-=a,r-=d):(t&&(n+=t-a),i&&(r+=i-d)),s(n,r)};qqdropbox.extend(this,{onAllComplete:l,onStatusChange:function(e,t,o){o===qqdropbox.status.CANCELED||o===qqdropbox.status.REJECTED?u(e):o===qqdropbox.status.SUBMITTING&&p(e)},onIndividualProgress:function(e,t,n){c(e,t,n),o[e]={loaded:t,total:n}},onNewSize:function(e){p(e)},reset:function(){o={},n=0,r=0}})},qqdropbox.UiEventHandler=function(e,t){"use strict";function o(e){n.attach(e,r.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;r.onHandled(t,e)})}var n=new qqdropbox.DisposeSupport,r={eventType:"click",attachTo:null,onHandled:function(){}};qqdropbox.extend(this,{addHandler:function(e){o(e)},dispose:function(){n.dispose()}}),qqdropbox.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return n}}),qqdropbox.extend(r,e),r.attachTo&&o(r.attachTo)},qqdropbox.FileButtonsClickHandler=function(e){"use strict";function t(e,t){qqdropbox.each(r,function(o,r){var i,a=o.charAt(0).toUpperCase()+o.slice(1);return n.templating["is"+a](e)?(i=n.templating.getFileId(e),qqdropbox.preventDefault(t),n.log(qqdropbox.format("Detected valid file button click event on file '{}', ID: {}.",n.onGetName(i),i)),r(i),!1):void 0})}var o={},n={templating:null,log:function(){},onDeleteFile:function(){},onCancel:function(){},onRetry:function(){},onPause:function(){},onContinue:function(){},onGetName:function(){}},r={cancel:function(e){n.onCancel(e)},retry:function(e){n.onRetry(e)},deleteButton:function(e){n.onDeleteFile(e)},pause:function(e){n.onPause(e)},continueButton:function(e){n.onContinue(e)}};qqdropbox.extend(n,e),n.eventType="click",n.onHandled=t,n.attachTo=n.templating.getFileList(),qqdropbox.extend(this,new qqdropbox.UiEventHandler(n,o))},qqdropbox.FilenameClickHandler=function(e){"use strict";function t(e,t){if(n.templating.isFileName(e)||n.templating.isEditIcon(e)){var r=n.templating.getFileId(e),i=n.onGetUploadStatus(r);i===qqdropbox.status.SUBMITTED&&(n.log(qqdropbox.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(r),r)),qqdropbox.preventDefault(t),o.handleFilenameEdit(r,e,!0))}}var o={},n={templating:null,log:function(){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(){},onGetName:function(){}};qqdropbox.extend(n,e),n.eventType="click",n.onHandled=t,qqdropbox.extend(this,new qqdropbox.FilenameEditHandler(n,o))},qqdropbox.FilenameInputFocusInHandler=function(e,t){"use strict";function o(e){if(n.templating.isEditInput(e)){var o=n.templating.getFileId(e),r=n.onGetUploadStatus(o);r===qqdropbox.status.SUBMITTED&&(n.log(qqdropbox.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(o),o)),t.handleFilenameEdit(o,e))}}var n={templating:null,onGetUploadStatus:function(){},log:function(){}};t||(t={}),n.eventType="focusin",n.onHandled=o,qqdropbox.extend(n,e),qqdropbox.extend(this,new qqdropbox.FilenameEditHandler(n,t))},qqdropbox.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,qqdropbox.extend(this,new qqdropbox.FilenameInputFocusInHandler(e,{}))},qqdropbox.FilenameEditHandler=function(e,t){"use strict";function o(e){var t=s.onGetName(e),o=t.lastIndexOf(".");return o>0&&(t=t.substr(0,o)),t}function n(e){var t=s.onGetName(e);return qqdropbox.getExtension(t)}function r(e,t){var o,r=e.value;void 0!==r&&qqdropbox.trimStr(r).length>0&&(o=n(t),void 0!==o&&(r=r+"."+o),s.onSetName(t,r)),s.onEditingStatusChange(t,!1)}function i(e,o){t.getDisposeSupport().attach(e,"blur",function(){r(e,o)})}function a(e,o){t.getDisposeSupport().attach(e,"keyup",function(t){var n=t.keyCode||t.which;13===n&&r(e,o)})}var s={templating:null,log:function(){},onGetUploadStatus:function(){},onGetName:function(){},onSetName:function(){},onEditingStatusChange:function(){}};qqdropbox.extend(s,e),s.attachTo=s.templating.getFileList(),qqdropbox.extend(this,new qqdropbox.UiEventHandler(s,t)),qqdropbox.extend(t,{handleFilenameEdit:function(e,t,n){var r=s.templating.getEditInput(e);s.onEditingStatusChange(e,!0),r.value=o(e),n&&r.focus(),i(r,e),a(r,e)}})};